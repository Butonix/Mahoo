(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{217:function(e,t,o){},226:function(e,t,o){},239:function(e,t,o){},241:function(e,t,o){},242:function(e,t,o){},244:function(e,t,o){"use strict";o(94),o(66),o(20);var n=o(2);t.a={data:()=>({uploadHeaders:{key:"",token:""},uploadConfig:{max:5},uploadImageLimit:20,imageUploadAccept:["image/jpeg","image/png","image/jpg"].join(", "),imageUploadAction:"https://upload.qiniup.com",imagePrefix:"https://m1.calibur.tv",getUpTokenTimer:0,uploadPending:0,uploadImageTotal:0,uploadImageList:[]}),computed:{currentUser(){return this.$store.state.user}},mounted(){this.getUpToken(),this.getUpTokenTimer=setInterval(()=>{this.getUpToken()},18e5)},beforeDestroy(){this.getUpTokenTimer&&clearInterval(this.getUpTokenTimer)},methods:{getUpToken(){var e=this;return Object(n.a)(function*(){try{e.uploadHeaders.token=yield e.$axios.get("v1/image/uptoken")}catch(e){}})()},handleImageUploadError(e,t){this.uploadImageList.forEach((o,n)=>{o.uid===t.uid&&(this.uploadPending--,this.uploadImageList.splice(n,1),console.log(e))}),this.$toast.error("图片：".concat(t.name," 上传失败"))},handleImageUploadRemove(e){this.uploadImageList.forEach((t,o)=>{t.uid===e.uid&&(this.uploadImageList.splice(o,1),this.uploadImageTotal--)})},handleImageUploadSuccess(e,t){this.uploadImageList.forEach((o,n)=>{o.uid===t.uid&&(this.uploadImageList[n]=Object.assign(o,{data:e.data,status:"success",url:"".concat(this.imagePrefix,"/").concat(e.data.url)}))}),this.uploadImageTotal++,this.uploadPending--},handleImageUploadExceed(){this.$toast.warn("最多还能上传".concat(this.uploadImageLimit-this.uploadImageTotal,"张图片"))},handleImageUploadBefore(e){if(!this.currentUser)return this.$channel.$emit("sign-in"),!1;if(-1===this.imageUploadAccept.split(", ").indexOf(e.type))return this.$toast.error("仅支持上传".concat(this.imageUploadAccept.replace(/image\//g,"").replace(/, /g,"、"),"格式的图片")),!1;if(this.uploadConfig.max&&this.uploadConfig.max<e.size/1024/1024)return this.$toast.error("图片大小不能超过 ".concat(this.uploadConfig.max,"MB!")),!1;return this.uploadHeaders.key=(e=>{let t=e.slug,o=e.file;return"".concat(t,"/").concat((new Date).getTime(),"-").concat(Math.random().toString(36).substring(3,6),".").concat(o.type.split("/").pop())})({slug:this.currentUser.slug,file:e}),this.uploadImageList.push({name:e.name,percentage:0,raw:e,size:e.size,status:"uploading",errMsg:"",uid:e.uid}),this.uploadPending++,!0}}}}}]);