(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{316:function(e,t,n){},319:function(e,t,n){"use strict";n(194);var r={name:"UserAvatar",props:{user:{type:Object,required:!0},avatar:{type:String,default:""},size:{type:Number,default:40},disabled:{type:Boolean,default:!1}}},o=(n(321),n(18)),component=Object(o.a)(r,function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.disabled?n("div",{staticClass:"user-avatar",style:{width:e.size+"px",height:e.size+"px"}},[n("VImg",{attrs:{radius:"50%",src:e.avatar||e.user.avatar,width:e.size,height:e.size,alt:e.user.nickname}})],1):n("NLink",{staticClass:"user-avatar",style:{width:e.size+"px",height:e.size+"px"},attrs:{to:e.$alias.user(e.user.slug),target:"_blank"}},[n("VImg",{attrs:{radius:"50%",src:e.avatar||e.user.avatar,width:e.size,height:e.size,alt:e.user.nickname}})],1)},[],!1,null,null,null);t.a=component.exports},321:function(e,t,n){"use strict";var r=n(316);n.n(r).a},326:function(e,t,n){"use strict";t.a={beforeMount:function(){var e=this;this.$channel.$when("user-not-sign",function(){e.$toast.error("继续操作前请先登录").then(function(){window.location.href=e.$alias.sign()})})}}},332:function(e,t,n){e.exports={h1:"h1_17sSx",h2:"h2_29h8C",h3:"h3_pcROM",h4:"h4_-wXkD",h5:"h5_3RgCW",h6:"h6_1UKhu","skeleton-loading":"skeleton-loading_3wvbo",skeletonLoading:"skeleton-loading_3wvbo",skeleton:"skeleton_3yQuF"}},333:function(e,t,n){e.exports={image:"image_2HoYb",border:"border_fvHwL",bg:"bg_OU_Qk","skeleton-loading":"skeleton-loading_W_WF0",skeletonLoading:"skeleton-loading_W_WF0",skeleton:"skeleton_3dcSj"}},334:function(e,t,n){e.exports={paragraph:"paragraph_1OWG2","skeleton-loading":"skeleton-loading_3Hgsp",skeletonLoading:"skeleton-loading_3Hgsp",skeleton:"skeleton_2H5RA"}},335:function(e,t,n){e.exports={list:"list_rxwoA","skeleton-loading":"skeleton-loading_hADmg",skeletonLoading:"skeleton-loading_hADmg",skeleton:"skeleton_3a9b2"}},336:function(e,t,n){e.exports={delimiter:"delimiter_3ksS5","skeleton-loading":"skeleton-loading_1lzJ0",skeletonLoading:"skeleton-loading_1lzJ0",skeleton:"skeleton_jIhh3"}},337:function(e,t,n){e.exports={checklist:"checklist_35Trq","skeleton-loading":"skeleton-loading_2NnRn",skeletonLoading:"skeleton-loading_2NnRn",skeleton:"skeleton_RKAJg"}},338:function(e,t,n){e.exports={link:"link_1cdqF",content:"content_31mUQ",logo:"logo_3t3p1","skeleton-loading":"skeleton-loading_Q1SbS",skeletonLoading:"skeleton-loading_Q1SbS",skeleton:"skeleton_13H0b"}},339:function(e,t,n){e.exports={video:"video_1Ktgc",wrap:"wrap_3iFmj","skeleton-loading":"skeleton-loading_DCN-u",skeletonLoading:"skeleton-loading_DCN-u",skeleton:"skeleton_1YNsK"}},340:function(e,t,n){e.exports={music:"music_1aU_y","skeleton-loading":"skeleton-loading_3yST_",skeletonLoading:"skeleton-loading_3yST_",skeleton:"skeleton_3Zagh"}},341:function(e,t,n){e.exports={baidu:"baidu_3yD19",logo:"logo_3fZIb",content:"content_2vYlq","skeleton-loading":"skeleton-loading_2_Vpm",skeletonLoading:"skeleton-loading_2_Vpm",skeleton:"skeleton_Yoxzs"}},353:function(e,t,n){"use strict";n(35),n(58);t.a={beforeMount:function(){var e=this,t=function(){e.$store.getters.isMine(e.$route.params.slug)||e.$router.replace({name:e.$route.name,params:{slug:e.$store.state.user.slug}})};if(this.$store.state.isAuth)t();else var n=this.$watch("$store.state.isAuth",function(e){e&&(t(),n())})}}},359:function(e,t,n){"use strict";var r={name:"JsonHeader",props:{item:{type:Object,required:!0}},render:function(e){var t=this.item.data.level;return e("h"+this.item.data.level,{class:this.$style["h".concat(t)],domProps:{innerHTML:this.item.data.text}})}},o=n(392),l=n(18);var header=Object(l.a)(r,void 0,void 0,!1,function(e){this.$style=o.default.locals||o.default},null,null).exports,c={name:"JsonImage",props:{item:{type:Object,required:!0}}},d=n(393);var h=Object(l.a)(c,function(){var e,t,n=this,r=n.$createElement,o=n._self._c||r;return o("div",{class:n.$style.image},[o("div",{class:[(e={},e[n.$style.border]=n.item.data.withBorder,e),(t={},t[n.$style.bg]=n.item.data.withBackground,t)]},[o("div",[o("VImg",{attrs:{src:n.item.data.file.url,stretched:n.item.data.stretched,width:n.item.data.file.width,height:n.item.data.file.height}})],1)]),n._v(" "),n.item.data.caption?o("p",{domProps:{textContent:n._s(n.item.data.caption)}}):n._e()])},[],!1,function(e){this.$style=d.default.locals||d.default},null,null).exports,m={name:"JsonParagraph",props:{item:{type:Object,required:!0}}},f=n(394);var v=Object(l.a)(m,function(){var e=this.$createElement;return(this._self._c||e)("p",{class:this.$style.paragraph,domProps:{innerHTML:this._s(this.item.data.text.replace(/\n/g,"<br>"))}})},[],!1,function(e){this.$style=f.default.locals||f.default},null,null).exports,_={name:"JsonList",props:{item:{type:Object,required:!0}}},y=n(395);var k=Object(l.a)(_,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.$style.list},["ordered"===e.item.data.style?n("ol",e._l(e.item.data.items,function(li,t){return n("li",{key:t,domProps:{textContent:e._s(li)}})}),0):n("ul",e._l(e.item.data.items,function(li,t){return n("li",{key:t,domProps:{textContent:e._s(li)}})}),0)])},[],!1,function(e){this.$style=y.default.locals||y.default},null,null).exports,$={name:"JsonDelimiter",props:{item:{type:Object,required:!0}}},x=n(396);var w=Object(l.a)($,function(){var e=this.$createElement;return(this._self._c||e)("div",{class:this.$style.delimiter})},[],!1,function(e){this.$style=x.default.locals||x.default},null,null).exports,C={name:"JsonChecklist",props:{item:{type:Object,required:!0}}},M=n(397);var S=Object(l.a)(C,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{class:e.$style.checklist},e._l(e.item.data.items,function(option,t){return n("li",{key:t},[option.checked?n("i"):n("em"),e._v(" "),n("div",{domProps:{textContent:e._s(option.text)}})])}),0)},[],!1,function(e){this.$style=M.default.locals||M.default},null,null).exports,O={name:"JsonLink",props:{item:{type:Object,required:!0}}},E=n(398);var L=Object(l.a)(O,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.$style.link},[n("a",{attrs:{target:"_blank",href:e.item.data.link}},[e.item.data.meta.image&&e.item.data.meta.image.url?n("img",{class:e.$style.logo,attrs:{src:e.item.data.meta.image.url,width:"65",height:"65"}}):e._e(),e._v(" "),n("div",{class:e.$style.content},[n("h3",{domProps:{textContent:e._s(e.item.data.meta.title)}}),e._v(" "),n("p",{staticClass:"oneline",domProps:{textContent:e._s(e.item.data.meta.description)}}),e._v(" "),n("span",{domProps:{textContent:e._s(e.item.data.link.replace(/https?:\/\//,""))}})])])])},[],!1,function(e){this.$style=E.default.locals||E.default},null,null).exports,j={name:"JsonVideo",props:{item:{type:Object,required:!0}}},T=n(399);var video=Object(l.a)(j,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.$style.video},[n("div",{class:e.$style.wrap},[n("iframe",{attrs:{src:e.item.data.embed,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowtransparency:"true",allowfullscreen:"true"}})]),e._v(" "),e.item.data.caption?n("p",{domProps:{textContent:e._s(e.item.data.caption)}}):e._e()])},[],!1,function(e){this.$style=T.default.locals||T.default},null,null).exports,R={name:"JsonMusic",props:{item:{type:Object,required:!0}}},H=n(400);var A=Object(l.a)(R,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{class:this.$style.music},[t("iframe",{attrs:{src:this.item.data.embed,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowtransparency:"true",allowfullscreen:"true",width:"330",height:"86"}}),this._v(" "),this.item.data.caption?t("p",{domProps:{textContent:this._s(this.item.data.caption)}}):this._e()])},[],!1,function(e){this.$style=H.default.locals||H.default},null,null).exports,D={name:"JsonBaidu",props:{item:{type:Object,required:!0},reward:{type:Boolean,required:!0}}},P=n(401);var J=Object(l.a)(D,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.$style.baidu},[n("a",{attrs:{href:e.item.data.url,target:"_blank"}},[n("i",{staticClass:"iconfont ic-baidu-cloud",class:e.$style.logo}),e._v(" "),n("div",{class:e.$style.content},[0===e.item.data.visit_type||e.reward?[e._v("\n        密码："+e._s(e.item.data.password)+"\n      ")]:[e._v("\n        密码投食后可见\n      ")]],2)])])},[],!1,function(e){this.$style=P.default.locals||P.default},null,null).exports,U=(n(143),n(61),n(62),n(5),n(63),n(36)),W=n(37),N=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.minLength,r=t.shareLink;Object(U.a)(this,e),this.config={org:"calibur",appendStr:"文章著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。",minLength:n||140,shareLink:r||window.location.href.split("?")[0]},this.prefix={org:"来源",link:"链接",author:"作者"}}return Object(W.a)(e,[{key:"bind",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.minLength,o=n.authorNickname,l=n.shareLink,c=n.appendStr;e.addEventListener("copy",function(e){var n=r||t.config.minLength,d=l||t.config.shareLink,h=c||t.config.appendStr,m=window.getSelection().getRangeAt(0),f=t.getHTMLParser("");f&&f.appendChild(m.cloneContents());var v=m.toString().trim(),_=f?f.innerHTML:t.getRangeHtml(m);if(document.createElement("div").innerHTML=_,v.length>=n){var y=t.getCopyHtml(_,d,o,h),k=t.getCopyText(v,d,o,h);void 0===e.clipboardData&&t.hack(y,m);try{e.clipboardData.setData("text/plain",k),e.clipboardData.setData("text/html",y),e.preventDefault()}catch(e){t.hack(y,m)}}})}},{key:"abort",value:function(e){e.addEventListener("copy",function(e){return e.stopPropagation(),e.preventDefault(),e.cancelBubble=!1,!1})}},{key:"hack",value:function(text,e){var t=document.createElement("div");t.innerHTML=text,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),window.getSelection().selectAllChildren(t),setTimeout(function(){try{window.getSelection().removeAllRanges(),window.getSelection().addRange(e)}catch(e){}document.body.removeChild(t)},0)}},{key:"getCopyHtml",value:function(html,e,t,n){var r=this.getExtraCopyright(e,t,n).join("<br>");return"<div><div>".concat(html,"</div>").concat(r,"</div>")}},{key:"getCopyText",value:function(text,e,t,n){return text+this.getExtraCopyright(e,t,n).join("\n")}},{key:"getExtraCopyright",value:function(e,t,n){return t?["","","".concat(this.prefix.author,"：").concat(t),"".concat(this.prefix.link,"：").concat(e),"".concat(this.prefix.org,"：").concat(this.config.org),n]:["","","".concat(this.prefix.link,"：").concat(e),"".concat(this.prefix.org,"：").concat(this.config.org),n]}},{key:"getRangeHtml",value:function(text){var div=document.createElement("div");return div.appendChild(text.cloneContents()),div.outerHTML}},{key:"getHTMLParser",value:function(e){try{return(new window.DOMParser).parseFromString(e,"text/html").body}catch(n){var t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t.body}}}]),e}(),I={name:"JsonContent",components:{"v-header":header,"v-image":h,"v-paragraph":v,"v-list":k,"v-delimiter":w,"v-checklist":S,"v-link":L,"v-video":video,"v-music":A,"v-baidu":J},props:{content:{required:!0,type:Array},reward:{type:Boolean,default:!1}},mounted:function(){(new N).bind(this.$el)}},B=Object(l.a)(I,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"json-content"},e._l(e.content,function(t,r){return n("v-"+t.type,{key:r,tag:"component",attrs:{item:t,reward:e.reward}})}),1)},[],!1,null,null,null);t.a=B.exports},392:function(e,t,n){"use strict";var r=n(332),o=n.n(r);t.default=o.a},393:function(e,t,n){"use strict";var r=n(333),o=n.n(r);t.default=o.a},394:function(e,t,n){"use strict";var r=n(334),o=n.n(r);t.default=o.a},395:function(e,t,n){"use strict";var r=n(335),o=n.n(r);t.default=o.a},396:function(e,t,n){"use strict";var r=n(336),o=n.n(r);t.default=o.a},397:function(e,t,n){"use strict";var r=n(337),o=n.n(r);t.default=o.a},398:function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.default=o.a},399:function(e,t,n){"use strict";var r=n(339),o=n.n(r);t.default=o.a},400:function(e,t,n){"use strict";var r=n(340),o=n.n(r);t.default=o.a},401:function(e,t,n){"use strict";var r=n(341),o=n.n(r);t.default=o.a},403:function(e,t,n){e.exports=n.p+"img/e82d3e7.png"},423:function(e,t,n){},424:function(e,t,n){},425:function(e,t,n){},426:function(e,t,n){},427:function(e,t,n){},428:function(e,t,n){},523:function(e,t,n){"use strict";var r=n(423);n.n(r).a},526:function(e,t,n){"use strict";var r=n(424);n.n(r).a},527:function(e,t,n){"use strict";var r=n(425);n.n(r).a},530:function(e,t,n){"use strict";var r=n(426);n.n(r).a},531:function(e,t,n){"use strict";var r=n(427);n.n(r).a},532:function(e,t,n){"use strict";var r=n(428);n.n(r).a},566:function(e,t,n){"use strict";n.r(t);n(35);var r=n(521),o=n.n(r),l=(n(19),n(2)),c=n(164),d={name:"MessageMenu",props:{slug:{type:String,required:!0}},data:function(){return{menuWatcher:null,timeWatcher:null,friends:[]}},computed:{menu:function(){return this.$store.state.messageMenu.list}},mounted:function(){var e=this;this.menuWatcher=this.$watch("$store.state.mailbox.unread_message_total",function(t,n){t>n&&!e.$store.state.socket.isConnected&&e.$store.dispatch("getMessageMenu")}),this.timeWatcher=this.$watch("$store.state.messageMenu.time",function(){e.$store.dispatch("updateMessageMenu")}),this.$store.dispatch("updateMessageMenu"),this.menu.length&&this.$store.state.socket.isConnected||this.initChatRoom()},beforeDestroy:function(){this.menuWatcher&&this.menuWatcher(),this.timeWatcher&&this.timeWatcher()},methods:{initChatRoom:function(){var e=Object(l.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.a.service({target:this.$el}),e.next=3,this.getUserFriends();case 3:return e.next=5,this.$store.dispatch("getMessageMenu");case 5:t.close();case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getUserFriends:function(){var e=Object(l.a)(regeneratorRuntime.mark(function e(){var t,n,r,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=function(){Object(c.getUserRelation)({$axios:o.$axios,slug:o.slug,relation:"friend"}).then(function(data){data.result.forEach(function(e){return o.$cache.setUserSessionStore(e)}),o.friends=data.result,sessionStorage.setItem("user-friends-list",JSON.stringify(data.result))})},e.prev=1,n=sessionStorage.getItem("user-friends-list")){e.next=7;break}return e.next=6,t();case 6:return e.abrupt("return");case 7:(r=JSON.parse(n)).forEach(function(e){return o.$cache.setUserSessionStore(e)}),this.friends=r,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,t();case 16:case"end":return e.stop()}},e,this,[[1,12]])}));return function(){return e.apply(this,arguments)}}(),deleteChannel:function(e){var t=this;this.$axios.$post("v1/message/delete_channel",{channel:e.channel}).then(function(){t.$store.commit("DELETE_MESSAGE_MENU",e.channel)}).catch(function(){})}}},h=(n(523),n(18)),m=Object(h.a)(d,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"message-menu"},e._l(e.menu,function(t){return n("li",{key:t.channel},[n("NLink",{staticClass:"room-item clearfix",attrs:{to:e.$alias.user(e.$route.params.slug,"message/?mailto="+t.channel+"&name="+t.user.nickname)}},[t.user.avatar?n("VImg",{attrs:{src:t.user.avatar,width:"42",height:"42",radius:"50%",alt:t.user.nickname}}):e._e(),e._v(" "),n("div",{staticClass:"content"},[n("p",{staticClass:"nickname oneline",domProps:{textContent:e._s(t.user.nickname)}}),e._v(" "),n("div",{staticClass:"footer"},[t.count?n("div",{staticClass:"read-badge",domProps:{textContent:e._s(t.count)}}):e._e()])])],1),e._v(" "),n("div",{staticClass:"close",on:{click:function(n){return e.deleteChannel(t)}}},[e._v("\n      ×\n    ")])],1)}),0)},[],!1,null,null,null).exports,f=(n(61),n(62),n(5),n(524)),v=n.n(f),_=(n(525),{name:"ChatAvatar",components:{UserAvatar:n(319).a},props:{item:{type:Object,required:!0}},computed:{isMine:function(){return this.$store.state.user.slug===this.item.slug}}}),y=(n(526),Object(h.a)(_,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"chat-avatar",class:[this.isMine?"chat-avatar-mine":"chat-avatar-other"]},[t("UserAvatar",{attrs:{user:this.item,size:36}})],1)},[],!1,null,null,null).exports),k={name:"ChatMessage",components:{JsonContent:n(359).a},props:{item:{type:Object,required:!0}}},$=(n(527),Object(h.a)(k,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"chat-message"},[t("JsonContent",{attrs:{content:this.item.content}})],1)},[],!1,null,null,null).exports),x=(n(194),n(528)),w=n(529),C={name:"VScroll",props:{probeType:{type:Number,default:1},click:{type:Boolean,default:!0},data:{type:Array,default:null},scrollX:{type:Boolean,default:!1}},watch:{data:function(){this.refresh()}},mounted:function(){var e=this;setTimeout(function(){e._initScroll()},20)},beforeDestroy:function(){this.scroll&&this.scroll.destroy()},methods:{_initScroll:function(){var e=this;this.$refs.wrapper&&(x.a.use(w.a),this.scroll=new x.a(this.$refs.wrapper,{probeType:this.probeType,click:this.click,fade:!0,scrollX:this.scrollX,scrollY:!this.scrollX,mouseWheel:{invert:!1,speed:30,easeTime:300}}),this.scroll.on("scrollEnd",function(){e.scroll.y>-50&&e.$emit("top"),e.scroll.y<=e.scroll.maxScrollY+50&&e.$emit("bottom")}))},enable:function(){this.scroll&&this.scroll.enable()},disable:function(){this.scroll&&this.scroll.disable()},refresh:function(){var e=this;return new Promise(function(t){e.$nextTick(function(){setTimeout(function(){e.scroll&&e.scroll.refresh(),e.$nextTick(function(){t()})},20)})})},scrollTo:function(){var e=this,t=arguments;setTimeout(function(){e.scroll&&e.scroll.scrollTo.apply(e.scroll,t)},0)},scrollToElement:function(){var e=this,t=arguments;setTimeout(function(){e.scroll&&e.scroll.scrollToElement.apply(e.scroll,t)},0)}}},M=(n(530),{name:"MessageRoom",components:{Scroll:Object(h.a)(C,function(){var e=this.$createElement;return(this._self._c||e)("div",{ref:"wrapper",staticClass:"scroll-warp"},[this._t("default")],2)},[],!1,null,null,null).exports,ChatRoom:v.a},props:{mailto:{type:String,required:!0},name:{type:String,required:!0},slug:{type:String,required:!0}},data:function(){return{message:"",target:null,chatsHeight:0,stopWatcher:null,noMore:!1}},computed:{query:function(){return{channel:this.mailto,$axios:this.$axios}},avatarComp:function(){return y},messageComps:function(){return{message:$}},computeHelperTxt:function(){return"undefined"==typeof window?"":/windows/.test(window.navigator.userAgent.toLocaleLowerCase())?"按下Ctrl+Enter换行":"按下Cmd+Enter换行"}},watch:{$route:function(){this.initRoom()}},beforeMount:function(){this.$store.state.messageRoom[this.mailto]||this.$store.commit("INIT_MESSAGE_ROOM",this.mailto)},mounted:function(){this.initRoom()},methods:{initRoom:function(){var e=this;this.$nextTick(Object(l.a)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.$refs.room&&e.$refs.room.clearMessage(),t.next=3,e.$refs.loader.initData({is_up:1});case 3:return t.next=5,e.$refs.loader.loadMore({force:!0});case 5:e.clearUnreadCount(),e.watchMessageLoop();case 7:case"end":return t.stop()}},t)})))},clearUnreadCount:function(){var e=this,menu=this.$store.state.messageMenu.list.filter(function(t){return t.channel===e.mailto})[0];!menu||menu.count<=0||(this.$axios.$post("v1/message/clear_channel",{channel:this.mailto}),this.$store.commit("CLEAR_NOTIFICATION",{channel:this.mailto,count:menu.count}))},watchMessageLoop:function(){this.stopWatcher&&this.stopWatcher();var e=this,t=e.mailto;this.stopWatcher=this.$watch(function(){return e.$store.state.messageRoom[e.mailto].time},function(){if(t===e.mailto){var n=e.$store.state.messageRoom[e.mailto].data;e.$store.state.socket.isConnected&&n?e.appendMessage(n):e.$refs.loader.loadMore({force:!0}),e.screenScroll(),e.clearUnreadCount()}else this.stopWatcher()})},handleScrollUp:function(){this.noMore||this.$refs.loader.loadBefore({force:!0})},handleMessageLoad:function(e){var t=this,data=e.data,n=e.params;0!==n.is_up||data.result.length||(this.noMore=!0),this.$nextTick(function(){1===n.is_up?(data.result.map(function(e){return e}).reverse().map(function(e){t.appendMessage(e,!1)}),t.screenScroll(!1)):(data.result.map(function(e){t.appendMessage(e)}),t.screenScroll())})},screenScroll:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$refs.scroll&&this.$refs.scroll.refresh().then(function(){var n=e.$refs.room.$el.clientHeight,r=e.$refs.wrap.clientHeight;n<r||(e.lastChatsHeight&&!t?e.$refs.scroll.scrollTo(0,e.lastChatsHeight-n):e.$refs.scroll.scrollTo(0,r-n),e.lastChatsHeight=n)})},appendMessage:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.$refs.room.addMessage({id:e.id,type:"message",float:e.user.slug===this.slug?"right":"left",color:2===e.user.sex?{bg:"#ff6881",text:"#fff"}:{bg:"#12b7f5",text:"#fff"},data:e},t)},handleAddBubble:function(){var e=this;if(this.message.trim()){var t=[{type:"paragraph",data:{text:this.message.trim()}}],n=Math.random().toString(10).substring(3,6);this.appendMessage({id:n,user:this.$store.state.user,content:t,created_at:Date.now()}),this.screenScroll(),this.message="",this.$axios.$post("v1/message/send",{channel:this.mailto,content:t}).then(function(t){e.$refs.room.updateMessage(n,{id:t.id}),e.$refs.loader.append(t)}).catch(function(){e.$refs.room.updateMessage(n,{status:"error"})})}},handleNewLine:function(){this.message&&(this.message+="\n")}}}),S=(n(531),Object(h.a)(M,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"room"},[n("div",{staticClass:"room-header"},[e._v("\n    "+e._s(e.name)+"\n  ")]),e._v(" "),n("no-ssr",[n("FlowLoader",{ref:"loader",staticClass:"room-body",attrs:{func:"getUserMessage",type:"sinceId",query:e.query,callback:e.handleMessageLoad,"cache-timeout":86400,auto:0},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.flow;return n("div",{ref:"wrap",staticClass:"room-chats"},[n("Scroll",{ref:"scroll",attrs:{data:r},on:{top:e.handleScrollUp}},[n("ChatRoom",{ref:"room",attrs:{"avatar-component":e.avatarComp,"message-components":e.messageComps}})],1)],1)}}])}),e._v(" "),n("div",{staticClass:"room-footer"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],attrs:{maxlength:"500",placeholder:"say it..."},domProps:{value:e.message},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.handleAddBubble(t))},function(t){return t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.handleAddBubble(t)):null}],keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.metaKey?(t.preventDefault(),e.handleNewLine(t)):null},input:function(t){t.target.composing||(e.message=t.target.value)}}}),e._v(" "),n("div",{staticClass:"helper"},[n("span",{domProps:{textContent:e._s(e.computeHelperTxt)}}),e._v(" "),n("button",{on:{click:e.handleAddBubble}},[e._v("\n          发送\n        ")])])])],1)],1)},[],!1,null,null,null).exports),O=n(353),E={name:"UserMessage",components:{MessageMenu:m,MessageRoom:S},mixins:[n(326).a,O.a],props:{slug:{type:String,required:!0}},computed:{mailto:function(){return this.$route.query.mailto},name:function(){return this.$route.query.name}}},L=(n(532),Object(h.a)(E,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"user-message"}},[r("ElRow",{staticClass:"column-wrap"},[r("ElCol",{attrs:{span:6}},[r("MessageMenu",{attrs:{slug:e.slug}}),e._v("\n       \n    ")],1),e._v(" "),r("ElCol",{attrs:{span:18}},[r("div",{staticClass:"room-adjust"},[e.mailto?r("MessageRoom",{attrs:{mailto:e.mailto,name:e.name,slug:e.slug}}):r("div",{staticClass:"need-pick"},[r("img",{attrs:{src:n(403)}}),e._v(" "),r("p",[e._v("未选择聊天")])])],1)])],1)],1)},[],!1,null,null,null));t.default=L.exports}}]);