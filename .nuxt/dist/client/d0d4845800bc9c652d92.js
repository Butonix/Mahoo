(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{311:function(t,e,n){"use strict";n(87),n(88),n(9),n(83),n(55),n(38),n(27);var o=n(2),r=n(132);e.a={data:function(){return{uploadHeaders:{key:"",token:""},uploadConfig:{max:5},uploadImageLimit:20,imageUploadAccept:["image/jpeg","image/png","image/jpg"].join(", "),imageUploadAction:"https://upload.qiniup.com",imagePrefix:"https://m1.calibur.tv/",getUpTokenTimer:0,uploadPending:0,uploadImageTotal:0,uploadImageList:[]}},computed:{currentUser:function(){return this.$store.state.user},isAuth:function(){return this.$store.state.isAuth}},watch:{isAuth:function(t){t&&this.initUpToken()}},mounted:function(){this.isAuth&&this.initUpToken()},beforeDestroy:function(){this.getUpTokenTimer&&clearInterval(this.getUpTokenTimer)},methods:{initUpToken:function(){var t=this;this.getUpToken(),this.getUpTokenTimer=setInterval(function(){t.getUpToken()},18e5)},getUpToken:function(){var t=Object(o.a)(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.$cookie.get("UPLOAD-TOKEN"))){t.next=4;break}return this.uploadHeaders.token=this.$cookie.get("UPLOAD-TOKEN"),t.abrupt("return");case 4:return t.next=6,Object(r.b)(this);case 6:e=t.sent,this.uploadHeaders.token=e,this.$cookie.set("UPLOAD-TOKEN",e,{expires:new Date((new Date).getTime()+3e6)});case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),handleImageUploadError:function(t,e){var n=this;this.uploadImageList.forEach(function(o,r){o.uid===e.uid&&(n.uploadPending--,n.uploadImageList.splice(r,1),console.log(t))}),this.$toast.error("图片：".concat(e.name," 上传失败"))},handleImageUploadRemove:function(t){var e=this;this.uploadImageList.forEach(function(n,o){n.uid===t.uid&&(e.uploadImageList.splice(o,1),e.uploadImageTotal--)})},handleImageUploadSuccess:function(t,e){var n=this;this.uploadImageList.forEach(function(o,r){o.uid===e.uid&&(n.uploadImageList[r]=Object.assign(o,{data:t.data,status:"success",url:n.$resize("".concat(n.imagePrefix).concat(t.data.url),{width:100})}))}),this.uploadImageTotal++,this.uploadPending--},handleImageUploadExceed:function(){this.$toast.info("最多还能上传".concat(this.uploadImageLimit-this.uploadImageTotal,"张图片"))},handleImageUploadBefore:function(t){if(!this.isAuth)return this.$channel.$emit("sign-in"),!1;if(-1===this.imageUploadAccept.split(", ").indexOf(t.type))return this.$toast.error("仅支持上传".concat(this.imageUploadAccept.replace(/image\//g,"").replace(/, /g,"、"),"格式的图片")),!1;if(this.uploadConfig.max&&this.uploadConfig.max<t.size/1024/1024)return this.$toast.error("图片大小不能超过 ".concat(this.uploadConfig.max,"MB!")),!1;return this.uploadHeaders.key=function(t){var e=t.slug,n=t.file;return"".concat(e,"/").concat((new Date).getTime(),"-").concat(Math.random().toString(36).substring(3,6),".").concat(n.type.split("/").pop())}({slug:this.currentUser.slug,file:t}),this.uploadImageList.push({name:t.name,percentage:0,raw:t,size:t.size,status:"uploading",errMsg:"",uid:t.uid}),this.uploadPending++,!0}}}},322:function(t,e,n){t.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(object,t){return Object.prototype.hasOwnProperty.call(object,t)},n.p="/dist/",n(n.s=52)}({0:function(t,e,n){"use strict";function o(t,e,n,o,r,l,c,d){var h,f="function"==typeof t?t.options:t;if(e&&(f.render=e,f.staticRenderFns=n,f._compiled=!0),o&&(f.functional=!0),l&&(f._scopeId="data-v-"+l),c?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(c)},f._ssrRegister=h):r&&(h=d?function(){r.call(this,this.$root.$options.shadowRoot)}:r),h)if(f.functional){f._injectStyles=h;var m=f.render;f.render=function(t,e){return h.call(e),m(t,e)}}else{var v=f.beforeCreate;f.beforeCreate=v?[].concat(v,h):[h]}return{exports:t,options:f}}n.d(e,"a",function(){return o})},3:function(t,e){t.exports=n(54)},33:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"el-select-dropdown__item",class:{selected:t.itemSelected,"is-disabled":t.disabled||t.groupDisabled||t.limitReached,hover:t.hover},on:{mouseenter:t.hoverItem,click:function(e){return e.stopPropagation(),t.selectOptionClick(e)}}},[t._t("default",[n("span",[t._v(t._s(t.currentLabel))])])],2)};o._withStripped=!0;var r=n(4),l=n.n(r),c=n(3),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h={mixins:[l.a],name:"ElOption",componentName:"ElOption",inject:["select"],props:{value:{required:!0},label:[String,Number],created:Boolean,disabled:{type:Boolean,default:!1}},data:function(){return{index:-1,groupDisabled:!1,visible:!0,hitState:!1,hover:!1}},computed:{isObject:function(){return"[object object]"===Object.prototype.toString.call(this.value).toLowerCase()},currentLabel:function(){return this.label||(this.isObject?"":this.value)},currentValue:function(){return this.value||this.label||""},itemSelected:function(){return this.select.multiple?this.contains(this.select.value,this.value):this.isEqual(this.value,this.select.value)},limitReached:function(){return!!this.select.multiple&&(!this.itemSelected&&(this.select.value||[]).length>=this.select.multipleLimit&&this.select.multipleLimit>0)}},watch:{currentLabel:function(){this.created||this.select.remote||this.dispatch("ElSelect","setSelected")},value:function(t,e){var n=this.select,o=n.remote,r=n.valueKey;if(!this.created&&!o){if(r&&"object"===(void 0===t?"undefined":d(t))&&"object"===(void 0===e?"undefined":d(e))&&t[r]===e[r])return;this.dispatch("ElSelect","setSelected")}}},methods:{isEqual:function(a,b){if(this.isObject){var t=this.select.valueKey;return Object(c.getValueByPath)(a,t)===Object(c.getValueByPath)(b,t)}return a===b},contains:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments[1];if(this.isObject){var n=this.select.valueKey;return t&&t.some(function(t){return Object(c.getValueByPath)(t,n)===Object(c.getValueByPath)(e,n)})}return t&&t.indexOf(e)>-1},handleGroupDisabled:function(t){this.groupDisabled=t},hoverItem:function(){this.disabled||this.groupDisabled||(this.select.hoverIndex=this.select.options.indexOf(this))},selectOptionClick:function(){!0!==this.disabled&&!0!==this.groupDisabled&&this.dispatch("ElSelect","handleOptionClick",[this,!0])},queryChange:function(t){this.visible=new RegExp(Object(c.escapeRegexpString)(t),"i").test(this.currentLabel)||this.created,this.visible||this.select.filteredOptionsCount--}},created:function(){this.select.options.push(this),this.select.cachedOptions.push(this),this.select.optionsCount++,this.select.filteredOptionsCount++,this.$on("queryChange",this.queryChange),this.$on("handleGroupDisabled",this.handleGroupDisabled)},beforeDestroy:function(){this.select.onOptionDestroy(this.select.options.indexOf(this))}},f=n(0),component=Object(f.a)(h,o,[],!1,null,null,null);component.options.__file="packages/select/src/option.vue";e.a=component.exports},4:function(t,e){t.exports=n(53)},52:function(t,e,n){"use strict";n.r(e);var o=n(33);o.a.install=function(t){t.component(o.a.name,o.a)},e.default=o.a}})},330:function(t,e,n){},376:function(t,e,n){"use strict";var o=n(330);n.n(o).a},427:function(t,e,n){"use strict";n.r(e);var o=n(322),r=n.n(o),l=n(323),c=n.n(l),d=n(320),h=n.n(d),f=n(311),m={name:"CreateTalkForm",components:{"el-upload":h.a,"el-select":c.a,"el-option":r.a},mixins:[f.a],props:{parentSlug:{type:String,default:""},parentType:{type:String,default:"",validator:function(t){return~["","pin","tag"].indexOf(t)}}},data:function(){return{uploadImageLimit:9,title:"",content:""}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{customImageUploadSuccess:function(t,e){this.handleImageUploadSuccess(t,e),this.uploadImageList=this.uploadImageList.filter(function(t){return"success"===t.status&&t.data.width>=420&&t.data.height>=420||"success"!==t.status}),this.uploadImageTotal=this.uploadImageList.length},submit:function(){var t=this;this.$axios.$post("v1/pin/create/daily",{title:this.title,content:this.content,images:this.uploadImageList.map(function(t){return t.data})}).then(function(data){console.log(data)}).catch(function(e){t.$toast.error(e.message)})}}},v=(n(376),n(26)),y={name:"CreateDaily",components:{CreateTalkForm:Object(v.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"create-talk-form"},[n("div",{staticClass:"title-wrap"},[n("el-input",{attrs:{placeholder:"请输入标题（建议30字以内）",maxlength:"30"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),t._v(" "),n("div",{staticClass:"content-wrap"},[n("button",{staticClass:"submit-btn",on:{click:t.submit}},[t._v("\n      点击"),n("br"),t._v("发送\n    ")]),t._v(" "),n("div",{staticClass:"input-wrap"},[n("el-input",{attrs:{type:"textarea",autosize:{minRows:3},"show-word-limit":!0,maxlength:"10000",placeholder:"请输入正文（请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论）"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)]),t._v(" "),n("el-upload",{staticClass:"el-upload-wrap",attrs:{multiple:"","list-type":"picture-card",action:t.imageUploadAction,limit:t.uploadImageLimit,data:t.uploadHeaders,"file-list":t.uploadImageList,accept:t.imageUploadAccept,"before-upload":t.handleImageUploadBefore,"on-success":t.customImageUploadSuccess,"on-error":t.handleImageUploadError,"on-remove":t.handleImageUploadRemove,"on-exceed":t.handleImageUploadExceed}},[n("i",{staticClass:"el-icon-plus"})])],1)},[],!1,null,null,null).exports},props:{},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{}},x=Object(v.a)(y,function(){var t=this.$createElement;return(this._self._c||t)("create-talk-form")},[],!1,null,null,null);e.default=x.exports}}]);