(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{264:function(e,t,n){},273:function(e,t,n){},286:function(e,t,n){},288:function(e,t,n){},289:function(e,t,n){},291:function(e,t,n){"use strict";n(90),n(91),n(16),n(62),n(36),n(24),n(29);var o=n(2);t.a={data:function(){return{uploadHeaders:{key:"",token:""},uploadConfig:{max:5},uploadImageLimit:20,imageUploadAccept:["image/jpeg","image/png","image/jpg"].join(", "),imageUploadAction:"https://upload.qiniup.com",imagePrefix:"https://m1.calibur.tv",getUpTokenTimer:0,uploadPending:0,uploadImageTotal:0,uploadImageList:[]}},computed:{currentUser:function(){return this.$store.state.user}},mounted:function(){var e=this;this.getUpToken(),this.getUpTokenTimer=setInterval(function(){e.getUpToken()},18e5)},beforeDestroy:function(){this.getUpTokenTimer&&clearInterval(this.getUpTokenTimer)},methods:{getUpToken:function(){var e=Object(o.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$axios.get("v1/image/uptoken");case 3:this.uploadHeaders.token=e.sent,e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}(),handleImageUploadError:function(e,t){var n=this;this.uploadImageList.forEach(function(o,r){o.uid===t.uid&&(n.uploadPending--,n.uploadImageList.splice(r,1),console.log(e))}),this.$toast.error("图片：".concat(t.name," 上传失败"))},handleImageUploadRemove:function(e){var t=this;this.uploadImageList.forEach(function(n,o){n.uid===e.uid&&(t.uploadImageList.splice(o,1),t.uploadImageTotal--)})},handleImageUploadSuccess:function(e,t){var n=this;this.uploadImageList.forEach(function(o,r){o.uid===t.uid&&(n.uploadImageList[r]=Object.assign(o,{data:e.data,status:"success",url:"".concat(n.imagePrefix,"/").concat(e.data.url)}))}),this.uploadImageTotal++,this.uploadPending--},handleImageUploadExceed:function(){this.$toast.warn("最多还能上传".concat(this.uploadImageLimit-this.uploadImageTotal,"张图片"))},handleImageUploadBefore:function(e){if(!this.currentUser)return this.$channel.$emit("sign-in"),!1;if(-1===this.imageUploadAccept.split(", ").indexOf(e.type))return this.$toast.error("仅支持上传".concat(this.imageUploadAccept.replace(/image\//g,"").replace(/, /g,"、"),"格式的图片")),!1;if(this.uploadConfig.max&&this.uploadConfig.max<e.size/1024/1024)return this.$toast.error("图片大小不能超过 ".concat(this.uploadConfig.max,"MB!")),!1;return this.uploadHeaders.key=function(e){var t=e.slug,n=e.file;return"".concat(t,"/").concat((new Date).getTime(),"-").concat(Math.random().toString(36).substring(3,6),".").concat(n.type.split("/").pop())}({slug:this.currentUser.slug,file:e}),this.uploadImageList.push({name:e.name,percentage:0,raw:e,size:e.size,status:"uploading",errMsg:"",uid:e.uid}),this.uploadPending++,!0}}}}}]);