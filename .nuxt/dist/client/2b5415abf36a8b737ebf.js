(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{318:function(t,e,n){"use strict";n(55),n(56),n(5),n(93),n(57),n(58),n(95),n(34),n(19);var o=n(2),r=n(136);e.a={data:function(){return{uploadHeaders:{key:"",token:""},uploadConfig:{max:5},uploadImageLimit:20,imageUploadAccept:["image/jpeg","image/png","image/jpg"].join(", "),imageUploadAction:"https://upload.qiniup.com",imagePrefix:"https://m1.calibur.tv/",getUpTokenTimer:0,uploadPending:0,uploadImageTotal:0,uploadImageList:[]}},computed:{currentUser:function(){return this.$store.state.user},isAuth:function(){return this.$store.state.isAuth}},mounted:function(){var t=this;this.$channel.$when("user-signed",function(){t.initUpToken()})},beforeDestroy:function(){this.getUpTokenTimer&&clearInterval(this.getUpTokenTimer)},methods:{initUpToken:function(){var t=this;this.getUpToken(),this.getUpTokenTimer=setInterval(function(){t.getUpToken()},18e5)},getUpToken:function(){var t=Object(o.a)(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.$cookie.get("UPLOAD-TOKEN"))){t.next=4;break}return this.uploadHeaders.token=this.$cookie.get("UPLOAD-TOKEN"),t.abrupt("return");case 4:return t.next=6,Object(r.b)(this);case 6:e=t.sent,this.uploadHeaders.token=e,this.$cookie.set("UPLOAD-TOKEN",e,{expires:new Date((new Date).getTime()+3e6)});case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),handleImageUploadError:function(t,e){var n=this;this.uploadImageList.forEach(function(o,r){o.uid===e.uid&&(n.uploadPending--,n.uploadImageList.splice(r,1),console.log(t))}),this.$toast.error("图片：".concat(e.name," 上传失败"))},handleImageUploadRemove:function(t){var e=this;this.uploadImageList.forEach(function(n,o){n.uid===t.uid&&(e.uploadImageList.splice(o,1),e.uploadImageTotal--)})},handleImageUploadSuccess:function(t,e){var n=this;this.uploadImageList.forEach(function(o,r){o.uid===e.uid&&(n.uploadImageList[r]=Object.assign(o,{data:t.data,status:"success",url:n.$resize("".concat(n.imagePrefix).concat(t.data.url),{width:100})}))}),this.uploadImageTotal++,this.uploadPending--},handleImageUploadExceed:function(){this.$toast.info("最多还能上传".concat(this.uploadImageLimit-this.uploadImageTotal,"张图片"))},handleImageUploadBefore:function(t){if(!this.isAuth)return this.$channel.$emit("sign-in"),!1;if(!this.imageUploadAccept.split(", ").includes(t.type))return this.$toast.error("仅支持上传".concat(this.imageUploadAccept.replace(/image\//g,"").replace(/, /g,"、"),"格式的图片")),!1;if(this.uploadConfig.max&&this.uploadConfig.max<t.size/1024/1024)return this.$toast.error("图片大小不能超过 ".concat(this.uploadConfig.max,"MB!")),!1;return this.uploadHeaders.key=function(t){var e=t.slug,n=t.file;return"".concat(e,"/").concat((new Date).getTime(),"-").concat(Math.random().toString(36).substring(3,6),".").concat(n.type.split("/").pop())}({slug:this.currentUser.slug,file:t}),this.uploadImageList.push({name:t.name,percentage:0,raw:t,size:t.size,status:"uploading",errMsg:"",uid:t.uid}),this.uploadPending++,!0},resetUploaderStatus:function(){this.uploadImageList=[],this.uploadImageTotal=0,this.uploadPending=0}}}},320:function(t,e,n){"use strict";n(19);var o=n(2),r=n(60);e.a={beforeMount:function(){var t=Object(o.a)(regeneratorRuntime.mark(function t(){var e,n,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.$store.state.logging){t.next=4;break}e=this.$watch("$store.state.logging",function(){o.$store.state.isAuth?(o.$channel.$fire("user-signed"),e()):o.$toast.error("继续操作前请先登录").then(function(){window.location.href=o.$alias.sign()})}),t.next=10;break;case 4:return n=Object(r.a)(),this.$store.commit("SET_USER_TOKEN",n),t.next=8,this.$store.dispatch("initAuth");case 8:t.sent?this.$channel.$fire("user-signed"):this.$toast.error("继续操作前请先登录").then(function(){window.location.href=o.$alias.sign()});case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},324:function(t,e,n){},341:function(t,e,n){"use strict";var o=n(135),r={name:"CreateTagBtn",props:{text:{type:String,default:"分区"},parent:{type:String,required:!0}},methods:{actionCreate:function(){var t=this;this.$prompt("请输入".concat(this.text,"名"),"新建".concat(this.text),{confirmButtonText:"提交",cancelButtonText:"取消"}).then(function(e){var n=e.value.trim();if(n.length>32)return t.$toast.error("名字不能超过32个字");Object(o.b)(t,{name:n,parent_slug:t.parent}).then(function(data){t.$emit("create",data)}).catch(function(e){t.$toast.error(e.message)})}).catch(function(){})}}},c=n(18),component=Object(c.a)(r,function(){var t=this.$createElement,e=this._self._c||t;return e("button",{attrs:{type:"button"},on:{click:this.actionCreate}},[e("i",{staticClass:"el-icon-folder-add"}),this._v(" "),e("span",[this._v("新建"+this._s(this.text))])])},[],!1,null,null,null);e.a=component.exports},361:function(t,e,n){},366:function(t,e,n){"use strict";var o=n(324);n.n(o).a},367:function(t,e,n){},368:function(t,e,n){},369:function(t,e,n){},441:function(t,e,n){"use strict";var o=n(444),r={name:"AreaPicker",components:{ElCascader:n.n(o).a},props:{value:{type:String,required:!0},placeholder:{type:String,default:"选择作品分区，如约会大作战"}},data:function(){return{selected:this.value}},computed:{options:function(){return this.$store.state.global.myTags.filter(function(t){return!~["notebook","topic"].indexOf(t.slug)})}},watch:{value:function(t){this.selected=t},selected:function(t){this.$emit("input",t)}},mounted:function(){var t=this;this.$channel.$when("user-signed",function(){t.$store.dispatch("global/getMyTags")})}},c=(n(366),n(18)),component=Object(c.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"area-picker"},[n("p",{staticClass:"tip"},[t._v("\n    提示：只展示已解禁的分区（可选项，发表后不可修改）\n  ")]),t._v(" "),n("ElCascader",{attrs:{placeholder:t.placeholder,options:t.options,props:{value:"slug",label:"name",emitPath:!1},filterable:""},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.node,data=e.data;return[o.isLeaf?[n("span",[t._v(t._s(data.name))])]:[n("span",[t._v(t._s(data.name))]),t._v(" "),n("span",[t._v(" ("+t._s(data.children.length)+") ")])]]}}]),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}})],1)},[],!1,null,null,null);e.a=component.exports},459:function(t,e,n){},460:function(t,e,n){var o=n(7),r=n(4).isFinite;o(o.S,"Number",{isFinite:function(t){return"number"==typeof t&&r(t)}})},461:function(t,e,n){var o=n(7),r=n(462)(!0);o(o.S,"Object",{entries:function(t){return r(t)}})},462:function(t,e,n){var o=n(8),r=n(36),c=n(37),l=n(66).f;t.exports=function(t){return function(e){for(var n,d=c(e),h=r(d),f=h.length,i=0,m=[];f>i;)n=h[i++],o&&!l.call(d,n)||m.push(t?[n,d[n]]:d[n]);return m}}},463:function(t,e,n){},464:function(t,e,n){"use strict";var o=n(361);n.n(o).a},469:function(t,e,n){"use strict";var o=n(367);n.n(o).a},470:function(t,e,n){"use strict";var o=n(368);n.n(o).a},471:function(t,e,n){"use strict";var o=n(369);n.n(o).a},555:function(t,e,n){"use strict";n.r(e);var o=n(16),r=n(344),c=n.n(r),l=n(320),d=n(318),h=(n(93),n(68),n(52)),f=(n(25),n(5),n(96),n(189),n(136)),m=(n(34),n(55),n(56),n(138)),v=n(139),_=(n(459),function(){function t(e){var data=e.data;Object(m.a)(this,t),this.data=data}return Object(v.a)(t,[{key:"render",value:function(){var t=document.createElement("div");t.classList.add("baidu-resource");var e=document.createElement("i");e.classList.add("iconfont","ic-baidu-cloud","baidu-resource-icon"),t.appendChild(e);var n=document.createElement("div");n.classList.add("baidu-resource-wrap"),t.appendChild(n);var o=document.createElement("input");o.classList.add("baidu-resource-url"),o.placeholder="粘贴资源链接到这里（仅支持百度云盘：pan.baidu.com）",o.type="text",o.value=this.data&&this.data.url?this.data.url:"",n.appendChild(o);var r=document.createElement("input");r.classList.add("baidu-resource-password"),r.placeholder="填写资源的密码（4~6位）",r.type="text",r.value=this.data&&this.data.password?this.data.password:"",n.appendChild(r);var c=document.createElement("div");c.classList.add("baidu-resource-role-wrap");var l="".concat(Math.random().toString(36).substring(3,6)),d=this.data&&this.data.visit_type?this.data.visit_type:0,h=document.createElement("span");h.textContent="是否需要投食才能看到密码：",c.appendChild(h);var f=document.createElement("input");f.classList.add("baidu-resource-role-public"),f.id="baidu-resource-role-public-".concat(l),f.name=l,f.type="radio",f.value=0,f.checked=0===d,c.appendChild(f);var m=document.createElement("label");m.setAttribute("for","baidu-resource-role-public-".concat(l)),m.textContent="否",m.classList.add("baidu-resource-label"),c.appendChild(m);var v=document.createElement("input");v.classList.add("baidu-resource-role-private"),v.id="baidu-resource-role-private-".concat(l),v.type="radio",v.name=l,v.value=1,v.checked=1===d,c.appendChild(v);var _=document.createElement("label");return _.setAttribute("for","baidu-resource-role-private-".concat(l)),_.textContent="是",_.classList.add("baidu-resource-label"),c.appendChild(_),n.appendChild(c),t}},{key:"save",value:function(t){var e=t.querySelector(".baidu-resource-url"),n=t.querySelector(".baidu-resource-password"),o=t.querySelector(".baidu-resource-role-public");return{url:e.value.trim(),password:n.value.trim(),visit_type:o.checked?0:1}}},{key:"validate",value:function(t){return!(!t.url||!t.password)&&!(!/https?:\/\/pan\.baidu\.com\/s\/([\w\W]+)/.test(t.url)||!/^[\w|\W]{4,6}$/.test(t.password))}}],[{key:"toolbox",get:function(){return{title:"百度云",icon:'<svg width="20px" height="16px" viewBox="0 0 256 206" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid">\n  <g>\n    <path d="M170.2517,56.8186 L192.5047,34.5656 L193.9877,25.1956 C153.4367,-11.6774 88.9757,-7.4964 52.4207,33.9196 C42.2667,45.4226 34.7337,59.7636 30.7167,74.5726 L38.6867,73.4496 L83.1917,66.1106 L86.6277,62.5966 C106.4247,40.8546 139.8977,37.9296 162.7557,56.4286 L170.2517,56.8186 Z"></path>\n    <path d="M224.2048,73.9182 C219.0898,55.0822 208.5888,38.1492 193.9878,25.1962 L162.7558,56.4282 C175.9438,67.2042 183.4568,83.4382 183.1348,100.4652 L183.1348,106.0092 C198.4858,106.0092 210.9318,118.4542 210.9318,133.8052 C210.9318,149.1572 198.4858,161.2902 183.1348,161.2902 L127.4638,161.2902 L121.9978,167.2242 L121.9978,200.5642 L127.4638,205.7952 L183.1348,205.7952 C223.0648,206.1062 255.6868,174.3012 255.9978,134.3712 C256.1858,110.1682 244.2528,87.4782 224.2048,73.9182"></path>\n    <path d="M71.8704,205.7957 L127.4634,205.7957 L127.4634,161.2897 L71.8704,161.2897 C67.9094,161.2887 64.0734,160.4377 60.4714,158.7917 L52.5844,161.2117 L30.1754,183.4647 L28.2234,191.0387 C40.7904,200.5277 56.1234,205.8637 71.8704,205.7957"></path>\n    <path d="M71.8704,61.4255 C31.9394,61.6635 -0.2366,94.2275 0.0014,134.1575 C0.1344,156.4555 10.5484,177.4455 28.2234,191.0385 L60.4714,158.7915 C46.4804,152.4705 40.2634,136.0055 46.5844,122.0155 C52.9044,108.0255 69.3704,101.8085 83.3594,108.1285 C89.5244,110.9135 94.4614,115.8515 97.2464,122.0155 L129.4944,89.7685 C115.7734,71.8315 94.4534,61.3445 71.8704,61.4255"></path>\n  </g>\n</svg>'}}}]),t}()),k=(n(460),n(201),n(58),n(95),n(10)),w=(n(461),n(463),n(80)),y=(n(57),{bilibili:{regex:/https?:\/\/www\.bilibili\.com\/video\/av([\w\W]+)/,embedUrl:"//player.bilibili.com/player.html?aid=<%= remote_id %>",html:"<iframe width='100%' height='400' scrolling='no' border='0' frameborder='no' framespacing='0' allowtransparency='true' allowfullscreen='true'></iframe>",id:function(t){return t[0].split("/")[0].split("?")[0]}},bilih5:{regex:/https?:\/\/m\.bilibili\.com\/video\/av([\w\W]+)/,embedUrl:"//player.bilibili.com/player.html?aid=<%= remote_id %>",html:"<iframe width='100%' height='400' scrolling='no' border='0' frameborder='no' framespacing='0' allowtransparency='true' allowfullscreen='true'></iframe>",id:function(t){return t[0].split(".")[0].split("?")[0]}},netease:{regex:/https?:\/\/music\.163\.com\/#\/song\?id=([\w\W]+)/,embedUrl:"//music.163.com/outchain/player?type=2&height=66&id=<%= remote_id %>",html:"<iframe frameborder='no' border='0' marginwidth='0' marginheight='0' width='330' height='86'></iframe>",id:function(t){return t[0].split("/")[0].split("?")[0]}},neteaseh5:{regex:/https?:\/\/music\.163\.com\/m\/song\?id=([\w\W]+)/,embedUrl:"//music.163.com/outchain/player?type=2&height=66&id=<%= remote_id %>",html:"<iframe frameborder='no' border='0' marginwidth='0' marginheight='0' width='330' height='86'></iframe>",id:function(t){return t[0].split("/")[0].split("?")[0]}}}),C=function(){function t(e){var data=e.data,n=e.api;Object(m.a)(this,t),this.api=n,this._data={},this.element=null,this.data=data}return Object(v.a)(t,[{key:"render",value:function(){var e=this;if(!this.data.service){var n=document.createElement("div");return this.element=n,n}var html=t.services[this.data.service].html,o=document.createElement("div"),caption=document.createElement("div"),template=document.createElement("template"),r=this.createPreloader();o.classList.add(this.CSS.baseClass,this.CSS.container,this.CSS.containerLoading),caption.classList.add(this.CSS.input,this.CSS.caption),o.appendChild(r),caption.contentEditable=!0,caption.dataset.placeholder="Enter a caption",caption.innerHTML=this.data.caption||"",template.innerHTML=html,template.content.firstChild.setAttribute("src",this.data.embed),template.content.firstChild.classList.add(this.CSS.content);var c=this.embedIsReady(o);return o.appendChild(template.content.firstChild),o.appendChild(caption),c.then(function(){o.classList.remove(e.CSS.containerLoading)}),this.element=o,o}},{key:"createPreloader",value:function(){var t=document.createElement("preloader"),e=document.createElement("div");return e.textContent=this.data.source,t.classList.add(this.CSS.preloader),e.classList.add(this.CSS.url),t.appendChild(e),t}},{key:"save",value:function(){return this.data}},{key:"onPaste",value:function(e){var n=e.detail,o=n.key,r=n.data,c=t.services[o],l=c.regex,d=c.embedUrl,h=c.width,f=c.height,m=c.id,v=void 0===m?function(t){return t.shift()}:m,_=l.exec(r).slice(1),embed=d.replace(/<\%\= remote\_id \%\>/g,v(_));this.data={service:o,source:r,embed:embed,width:h,height:f}}},{key:"embedIsReady",value:function(t){var e=null;return new Promise(function(n,o){(e=new MutationObserver(Object(w.a)(450,n))).observe(t,{childList:!0,subtree:!0})}).then(function(){e.disconnect()})}},{key:"data",set:function(data){if(!(data instanceof Object))throw new TypeError("Embed Tool data should be object");var t=data.service,source=data.source,embed=data.embed,e=data.width,n=data.height,o=data.caption,caption=void 0===o?"":o;this._data={service:t||this.data.service,source:source||this.data.source,embed:embed||this.data.embed,width:e||this.data.width,height:n||this.data.height,caption:caption||this.data.caption||""};var r=this.element;r&&r.parentNode.replaceChild(this.render(),r)},get:function(){if(this.element){var caption=this.element.querySelector(".".concat(this.api.styles.input));this._data.caption=caption?caption.innerHTML:""}return this._data}},{key:"CSS",get:function(){return{baseClass:this.api.styles.block,input:this.api.styles.input,container:"embed-tool",containerLoading:"embed-tool--loading",preloader:"embed-tool__preloader",caption:"embed-tool__caption",url:"embed-tool__url",content:"embed-tool__content"}}}],[{key:"prepare",value:function(e){var n=e.config,o=(void 0===n?{}:n).services,r=void 0===o?{}:o,c=Object.entries(y),l=Object.entries(r).filter(function(t){var e=Object(h.a)(t,2),n=(e[0],e[1]);return"boolean"==typeof n&&!0===n}).map(function(t){return Object(h.a)(t,1)[0]}),d=Object.entries(r).filter(function(t){var e=Object(h.a)(t,2),n=(e[0],e[1]);return"object"===Object(k.a)(n)}).filter(function(e){var n=Object(h.a)(e,2),o=(n[0],n[1]);return t.checkServiceConfig(o)}).map(function(t){var e=Object(h.a)(t,2),n=e[0],o=e[1];return[n,{regex:o.regex,embedUrl:o.embedUrl,html:o.html,height:o.height,width:o.width,id:o.id}]});l.length&&(c=c.filter(function(t){var e=Object(h.a)(t,1)[0];return l.includes(e)})),c=c.concat(d),t.services=c.reduce(function(t,e){var n=Object(h.a)(e,2),o=n[0],r=n[1];return o in t?(t[o]=Object.assign({},t[o],r),t):(t[o]=r,t)},{}),t.patterns=c.reduce(function(t,e){var n=Object(h.a)(e,2),o=n[0],r=n[1];return t[o]=r.regex,t},{})}},{key:"checkServiceConfig",value:function(t){var e=t.regex,n=t.embedUrl,html=t.html,o=t.height,r=t.width,c=t.id,l=e&&e instanceof RegExp&&n&&"string"==typeof n&&html&&"string"==typeof html;return l=(l=(l=l&&(void 0===c||c instanceof Function))&&(void 0===o||Number.isFinite(o)))&&(void 0===r||Number.isFinite(r))}},{key:"pasteConfig",get:function(){return{patterns:t.patterns}}}]),t}(),$={name:"JsonEditor",mixins:[d.a],props:{value:{required:!0,type:Array},slug:{type:String,default:""},time:{type:[String,Number],default:""},autofocus:{type:Boolean,default:!1}},data:function(){return{editor:null}},mounted:function(){this.initEditor()},methods:{initEditor:function(){var t=this;Promise.all([n.e(53).then(n.t.bind(null,544,7)),n.e(54).then(n.t.bind(null,545,7)),n.e(57).then(n.t.bind(null,546,7)),n.e(52).then(n.t.bind(null,547,7)),n.e(56).then(n.t.bind(null,548,7)),n.e(55).then(n.t.bind(null,549,7)),n.e(51).then(n.t.bind(null,550,7))]).then(function(e){var n=t,data={};n.slug?data={blocks:n.value,time:Date.now(),version:n.$cache.get("editor_version","2.15.0")}:n.$cache.has("editor_local_draft")&&(data=n.$cache.get("editor_local_draft"),n.$emit("input",data.blocks));var o=e.map(function(t){return t.default}),r=Object(h.a)(o,7),c=r[0],l=r[1],d=r[2],m=r[3],v=r[4],k=r[5],w=r[6],y=new c({data:n.decodeData(data||{}),holder:"codex-editor",placeholder:"请输入内容",autofocus:n.autofocus,tools:{video:{class:C,inlineToolbar:!0},header:{class:l,shortcut:"CMD+SHIFT+H",inlineToolbar:!0},image:{class:k,shortcut:"CMD+SHIFT+P",types:"image/jpeg, image/png, image/jpg",config:{uploader:{uploadByFile:function(t){return new Promise(function(e,o){var r=new FormData;r.append("file",t),r.append("token",n.uploadHeaders.token),Object(f.c)(n,r).then(function(data){data.url="https://m1.calibur.tv/".concat(data.url),e({success:1,file:data})}).catch(o)})}}}},link:{class:v,shortcut:"CMD+SHIFT+L",config:{endpoint:"".concat("https://api.calibur.tv/","v1/pin/editor/fetch_site")}},delimiter:m,list:{class:d,shortcut:"CMD+SHIFT+U",inlineToolbar:!0},checklist:{class:w,inlineToolbar:!0},baidu:_},onChange:function(){n.handleSave()}});y.isReady.then(function(){t.editor=y,t.bindSaveEvent(),t.handleSave()}).catch(function(e){t.$toast.error("编辑器初始化失败：".concat(e))})})},bindSaveEvent:function(){var t=this;document.addEventListener("keydown",function(e){83===e.keyCode&&(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),e.preventDefault(),t.handleSave())},!1)},handleSave:function(){var t=this;this.editor&&this.editor.save().then(function(e){var n=t.encodeData(e),o=t.slug?"editor_local_draft-".concat(t.slug):"editor_local_draft";t.$cache.set(o,n),t.$cache.set("editor_version",n.version),t.value&&t.$emit("input",n.blocks),t.$emit("save")}).catch(function(){t.$toast.error("保存失败")})},decodeData:function(t){var e=t.version,n=t.blocks,time=t.time;return n?(n.forEach(function(t,e){"music"===t.type&&(n[e].type="video")}),{version:e,blocks:n,time:time}):null},encodeData:function(t){var e=t.version,n=t.blocks,time=t.time;return n.forEach(function(t,e){"video"===t.type&&t.data.service.startsWith("netease")&&(n[e].type="music",n[e].data.embed=n[e].data.embed.replace(/&amp;/g,"&"))}),{version:e,blocks:n,time:time}}}},x=(n(464),n(18)),E=Object(x.a)($,function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"editor-wrap"},[e("div",{staticClass:"mousetrap",attrs:{id:"codex-editor"}})])}],!1,null,null,null).exports,S=n(441),L=n(325),T=n.n(L),O=n(343),U=n.n(O),j={name:"TopicPicker",components:{ElSelect:U.a,ElOption:T.a},props:{value:{type:String,required:!0},placeholder:{type:String,default:"选择作品话题，如 cosplay"}},data:function(){return{selected:this.value}},computed:{options:function(){return this.$store.state.global.myTags.filter(function(t){return"topic"===t.slug})[0].children}},watch:{value:function(t){this.selected=t},selected:function(t){this.$emit("input",t)}},mounted:function(){var t=this;this.$channel.$when("user-signed",function(){t.$store.dispatch("global/getMyTags")})}},I=(n(469),Object(x.a)(j,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"topic-picker"},[n("p",{staticClass:"tip"},[t._v("\n    提示：只展示已关注的话题（必选项，填写后不可修改）\n  ")]),t._v(" "),n("ElSelect",{attrs:{filterable:"","default-first-option":"",placeholder:"请选择"},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},t._l(t.options,function(t){return n("ElOption",{key:t.slug,attrs:{label:t.name,value:t.slug}})}),1)],1)},[],!1,null,null,null).exports),P=n(341),M={name:"NotebookPicker",components:{ElSelect:U.a,ElOption:T.a,CreateTagBtn:P.a},props:{value:{type:String,required:!0}},data:function(){return{selected:this.value,newTags:[]}},computed:{options:function(){return this.newTags.concat(this.$store.state.global.myTags.filter(function(t){return"notebook"===t.slug})[0].children)}},watch:{selected:function(t){this.$emit("input",t)},value:function(t){this.selected=t},"options.length":function(){this.selected||(this.selected=this.options[0].slug)}},mounted:function(){var t=this;this.$channel.$when("user-signed",function(){t.$store.dispatch("global/getMyTags")})},methods:{handleCreate:function(data){this.newTags.unshift(data),this.selected=data.slug}}},A=(n(470),Object(x.a)(M,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"notebook-picker"},[n("div",{staticClass:"new-btn"},[n("CreateTagBtn",{attrs:{text:"专栏",parent:"uh4f"},on:{create:t.handleCreate}})],1),t._v(" "),n("div",{staticClass:"selection"},[n("ElSelect",{attrs:{filterable:"","default-first-option":"",placeholder:"请选择"},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},t._l(t.options,function(t){return n("ElOption",{key:t.slug,attrs:{label:t.name,value:t.slug}})}),1)],1)])},[],!1,null,null,null).exports),B={name:"Wander",layout:"web",components:{Editor:E,AreaPicker:S.a,TopicPicker:I,NotebookPicker:A,ElUpload:c.a},mixins:[l.a,d.a],head:{title:"创作中心"},data:function(){return{slug:"",title:{banner:null,text:""},content:[],notebook:"",area:"",topic:"ugf6",last_edit_at:"",visit_type:0,loading:!1}},asyncData:function(t){var e=t.app,n=t.error,r=t.query.slug;if(r)return e.$axios.$get("v1/pin/update/content",{params:{slug:r}}).then(function(data){return data.area=data.area?data.area.slug:"",data.topic=data.topic?data.topic.slug:"",data.notebook=data.notebook?data.notebook.slug:"",Object(o.a)({},data)}).catch(n)},mounted:function(){this.$cache.has("editor_local_draft_title-".concat(this.slug))&&(this.title=this.$cache.get("editor_local_draft_title-".concat(this.slug)))},methods:{customImageUploadSuccess:function(t,e){this.handleImageUploadSuccess(t,e);var n=t.data;if(n.width<960||n.height<540)return this.handleImageUploadRemove(e),void this.$toast.info("图片尺寸不符合要求");this.title.banner=n,this.saveTitle()},onEditorSave:function(){this.saveTitle()},saveTitle:function(){this.$cache.set("editor_local_draft_title-".concat(this.slug),this.title)},deleteBanner:function(){this.title.banner=null,this.saveTitle()},preValidate:function(){return!!this.loading||(this.title.text?this.content.length?this.topic?this.notebook?(this.loading=!0,!1):(this.$toast.info("请选择专栏"),!0):(this.$toast.info("请选择话题"),!0):(this.$toast.info("内容不能为空"),!0):(this.$toast.info("标题不能为空"),!0))},actionCreate:function(t){var e=this;this.preValidate()||this.$axios.$post("v1/pin/create/story",{area:this.area,topic:this.topic,notebook:this.notebook,content:[{type:"title",data:this.title}].concat(this.content),publish:t}).then(function(t){e.$cache.remove("editor_local_draft_title-".concat(e.slug)),e.$cache.remove("editor_local_draft"),window.location=e.$alias.pin(t)}).catch(function(t){e.$toast.error(t.message),e.loading=!1})},actionUpdate:function(t){var e=this;if(!this.preValidate()){var n=this.slug;this.$axios.$post("v1/pin/update/story",{slug:n,area:this.area,topic:this.topic,notebook:this.notebook,content:[{type:"title",data:this.title}].concat(this.content),publish:t}).then(function(t){e.$cache.remove("editor_local_draft_title-".concat(n)),e.$cache.remove("editor_local_draft-".concat(n)),window.location=e.$alias.pin(t)}).catch(function(t){e.$toast.error(t.message),e.loading=!1})}},actionRedo:function(){(this.content.length||this.title.text.length||this.title.banner)&&(this.slug?(this.$cache.remove("editor_local_draft_title-".concat(this.slug)),this.$cache.remove("editor_local_draft-".concat(this.slug))):(this.$cache.remove("editor_local_draft_title"),this.$cache.remove("editor_local_draft")),this.$toast.success("删除成功").then(function(){window.location.reload()}))}}},D=(n(471),Object(x.a)(B,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"wander"}},[n("div",{staticClass:"wrap"},[n("div",{staticClass:"banner"},[n("ElUpload",{staticClass:"uploader",attrs:{drag:"",action:t.imageUploadAction,accept:t.imageUploadAccept,data:t.uploadHeaders,"before-upload":t.handleImageUploadBefore,"on-success":t.customImageUploadSuccess,"on-error":t.handleImageUploadError}},[n("div",{staticClass:"el-upload-tip",attrs:{slot:"tip"},slot:"tip"},[n("i",{staticClass:"el-icon-picture"}),t._v(" "),n("div",[t._v("请添加封面图（选填）")]),t._v(" "),n("p",[t._v("支持8MB内的JPG／JPEG／PNG格式的高清图片"),n("br"),t._v("（建议大于960*540像素）")])])]),t._v(" "),t.title&&t.title.banner?[n("div",{staticClass:"image",style:{backgroundImage:"url("+t.$resize(t.title.banner.url,{width:660})}}),t._v(" "),n("div",{staticClass:"tool"},[n("i",{staticClass:"el-icon-delete",on:{click:t.deleteBanner}})])]:t._e()],2),t._v(" "),n("div",{staticClass:"title"},[n("ElInput",{attrs:{"show-word-limit":!0,autosize:{minRows:1,maxRows:2},type:"textarea",resize:"none",placeholder:"请输入标题（建议30字以内）",maxlength:"40"},model:{value:t.title.text,callback:function(e){t.$set(t.title,"text",e)},expression:"title.text"}})],1),t._v(" "),n("Editor",{attrs:{slug:t.slug,time:t.last_edit_at},on:{save:t.onEditorSave},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),t._v(" "),n("ElForm",{staticClass:"footer",attrs:{"label-position":"top","label-width":"80px"}},[n("ElFormItem",{attrs:{label:"选择分区"}},[n("AreaPicker",{model:{value:t.area,callback:function(e){t.area=e},expression:"area"}})],1),t._v(" "),n("ElFormItem",{attrs:{label:"选择话题"}},[n("TopicPicker",{model:{value:t.topic,callback:function(e){t.topic=e},expression:"topic"}})],1),t._v(" "),n("ElFormItem",{attrs:{label:"选择专栏"}},[n("NotebookPicker",{model:{value:t.notebook,callback:function(e){t.notebook=e},expression:"notebook"}})],1),t._v(" "),n("ElFormItem",{staticClass:"button-wrap"},[t.slug?[n("ElButton",{attrs:{loading:t.loading,type:"success",round:""},on:{click:function(e){return t.actionUpdate(!0)}}},[t._v("\n            发布更新\n          ")]),t._v(" "),1===t.visit_type?n("ElButton",{attrs:{loading:t.loading,round:"",plain:"",type:"warning"},on:{click:function(e){return t.actionUpdate(!1)}}},[t._v("\n            存草稿\n          ")]):t._e(),t._v(" "),n("ElButton",{attrs:{loading:t.loading,type:"primary",round:"",plain:""},on:{click:t.actionRedo}},[t._v("\n            撤销修改\n          ")])]:[n("ElButton",{attrs:{loading:t.loading,type:"success",round:""},on:{click:function(e){return t.actionCreate(!0)}}},[t._v("\n            发表文章\n          ")]),t._v(" "),n("ElButton",{attrs:{loading:t.loading,round:"",plain:"",type:"warning"},on:{click:function(e){return t.actionCreate(!1)}}},[t._v("\n            存草稿\n          ")]),t._v(" "),n("ElButton",{attrs:{loading:t.loading,type:"primary",round:"",plain:""},on:{click:t.actionRedo}},[t._v("\n            删除文章\n          ")])]],2)],1)],1)])},[],!1,null,null,null));e.default=D.exports}}]);