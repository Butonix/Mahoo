(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{377:function(t,e,n){},378:function(t,e,n){},451:function(t,e,n){t.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(object,t){return Object.prototype.hasOwnProperty.call(object,t)},n.p="/dist/",n(n.s=76)}({0:function(t,e,n){"use strict";function o(t,e,n,o,r,c,l,d){var h,f="function"==typeof t?t.options:t;if(e&&(f.render=e,f.staticRenderFns=n,f._compiled=!0),o&&(f.functional=!0),c&&(f._scopeId="data-v-"+c),l?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(l)},f._ssrRegister=h):r&&(h=d?function(){r.call(this,this.$root.$options.shadowRoot)}:r),h)if(f.functional){f._injectStyles=h;var v=f.render;f.render=function(t,e){return h.call(e),v(t,e)}}else{var m=f.beforeCreate;f.beforeCreate=m?[].concat(m,h):[h]}return{exports:t,options:f}}n.d(e,"a",function(){return o})},76:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"el-badge"},[t._t("default"),n("transition",{attrs:{name:"el-zoom-in-center"}},[n("sup",{directives:[{name:"show",rawName:"v-show",value:!t.hidden&&(t.content||0===t.content||t.isDot),expression:"!hidden && (content || content === 0 || isDot)"}],staticClass:"el-badge__content",class:["el-badge__content--"+t.type,{"is-fixed":t.$slots.default,"is-dot":t.isDot}],domProps:{textContent:t._s(t.content)}})])],2)};o._withStripped=!0;var r={name:"ElBadge",props:{value:{},max:Number,isDot:Boolean,hidden:Boolean,type:{type:String,validator:function(t){return["primary","success","warning","info","danger"].indexOf(t)>-1}}},computed:{content:function(){if(!this.isDot){var t=this.value,e=this.max;return"number"==typeof t&&"number"==typeof e&&e<t?e+"+":t}}}},c=n(0),component=Object(c.a)(r,o,[],!1,null,null,null);component.options.__file="packages/badge/src/main.vue";var main=component.exports;main.install=function(t){t.component(main.name,main)};e.default=main}})},452:function(t,e,n){"use strict";var o=n(377);n.n(o).a},453:function(t,e,n){"use strict";var o=n(378);n.n(o).a},473:function(t,e,n){"use strict";n.r(e);var o=n(451),r=n.n(o),c=n(40),l=n(178),d={components:{"el-badge":r.a},data:function(){return{headers:[{route:"/",name:"首页"},{route:"/tag/2he",name:"动漫"},{route:"/tag/285",name:"游戏"},{route:"/tag/3p6",name:"话题"}]}},computed:{isAuth:function(){return this.$store.state.isAuth},user:function(){return this.$store.state.user},mailbox:function(){return this.$store.state.mailbox}},beforeMount:function(){var t=this;this.$watch("isAuth",function(e){e&&t.getUnreadMessageCount()})},methods:{handleLogout:function(){Object(c.f)(this),this.$cookie.remove("JWT-TOKEN"),this.$channel.socketDisconnect(),window.location="/"},handleSignIn:function(){this.$channel.$emit("sign-in")},getUnreadMessageCount:function(){var t=this;this.$store.dispatch("refreshMailbox");var e=Date.now(),n=!0;window.addEventListener("mousemove",Object(l.a)(3e3,function(){e=Date.now()})),document.addEventListener("visibilitychange",function(){n="visible"===document.visibilityState}),setInterval(function(){n&&Date.now()-e<3e4&&t.$store.dispatch("refreshMailbox")},1e4)}}},h=(n(452),n(18)),f=Object(h.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("header",{attrs:{id:"page-header"}},[n("div",{staticClass:"header-fixed"},[n("div",{staticClass:"container nav"},[n("nav",{staticClass:"left"},[n("nuxt-link",{staticClass:"logo",attrs:{to:"/"}},[n("v-img",{attrs:{src:"default-poster",width:"32",height:"32",radius:"50%",alt:"calibur"}})],1),t._v(" "),n("v-switcher",{attrs:{headers:t.headers,routable:!0,align:"start"}},t._l(t.headers,function(e,o){return n("nuxt-link",{key:o,attrs:{slot:"tab-"+o,to:e.route},slot:"tab-"+o},[n("span",{domProps:{textContent:t._s(e.name)}})])}),1)],1),t._v(" "),n("div",{staticClass:"right"},[t.isAuth?[n("div",{staticClass:"user-panel icon-link"},[n("nuxt-link",{staticClass:"avatar",attrs:{to:t.$alias.user(t.user.slug)}},[n("v-img",{attrs:{src:t.user.avatar,def:"default-avatar",width:"33",height:"33",radius:"50%",alt:t.user.nickname}})],1),t._v(" "),n("div",{staticClass:"user-popover"},[n("div",{staticClass:"bottom"},[n("button",{on:{click:t.handleLogout}},[t._v("\n                  退出\n                ")])])])],1),t._v(" "),n("nuxt-link",{staticClass:"icon-link",attrs:{to:t.$alias.user(t.user.slug,"message")}},[n("el-badge",{attrs:{value:t.mailbox.unread_message_total,hidden:!t.mailbox.unread_message_total}},[n("i",{staticClass:"iconfont ic-message"})])],1),t._v(" "),n("nuxt-link",{staticClass:"icon-link",attrs:{to:t.$alias.user(t.user.slug,"message")}},[n("el-badge",{attrs:{value:t.mailbox.unread_notice_total,hidden:!t.mailbox.unread_notice_total}},[n("i",{staticClass:"iconfont ic-remind"})])],1)]:[n("el-button",{attrs:{type:"text"},on:{click:t.handleSignIn}},[t._v("\n            登录\n          ")])],t._v(" "),n("div",{staticClass:"creator-wrap"},[n("nuxt-link",{attrs:{to:"/create/daily/"}},[n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-s-promotion"}},[t._v("\n              投稿\n            ")])],1)],1)],2)])]),t._v(" "),n("div",{staticClass:"header-shim"})])},[],!1,null,null,null).exports,v=n(391),m=n(389),w=n(390),_={name:"SignDialog",components:{SignUpForm:m.a,SignInForm:v.a,ResetPasswordForm:w.a},data:function(){return{canRender:!1,showModal:!1,showSignIn:!1,showSignUp:!1,showReset:!1}},computed:{isGuest:function(){return!this.$store.state.isAuth}},mounted:function(){var t=this;this.canRender=!0,this.$channel.$on("sign-in",function(){t.showLogin()}),this.$channel.$on("sign-up",function(){t.showRegister()})},methods:{showLogin:function(){this.showReset=!1,this.showModal=!0,this.showSignIn=!0,this.showSignUp=!1},showRegister:function(){this.showModal=!0,this.showSignUp=!0,this.showSignIn=!1},hiddenSign:function(){this.showModal=!1,this.showSignIn=!1,this.showSignUp=!1,this.showReset=!1}}},S=(n(453),Object(h.a)(_,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.canRender?n("div",{staticClass:"sign-container"},[t.isGuest?n("div",{class:[t.showModal?"space-enter":"space-leave"],attrs:{id:"space3D"},on:{click:t.hiddenSign}},[n("div",{ref:"wrap",staticClass:"sign-modal-wrap"},[n("div",{staticClass:"sign-modal sign-in-modal",class:{"sign-in-init":!t.showSignIn&&!t.showSignUp,"sign-in-show":t.showSignIn&&!t.showSignUp,"sign-in-turn":!t.showSignIn&&t.showSignUp},on:{click:function(t){t.stopPropagation()}}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.showReset,expression:"showReset"}],staticClass:"form-container"},[n("reset-password-form",{on:{"to-login":function(e){t.showReset=!1},"to-register":t.showRegister}})],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.showReset,expression:"!showReset"}],staticClass:"form-container"},[n("sign-in-form",{on:{"to-reset":function(e){t.showReset=!0},"to-register":t.showRegister}})],1)]),t._v(" "),n("div",{staticClass:"sign-modal sign-up-modal",class:{"sign-up-init":!t.showSignUp&&!t.showSignIn,"sign-up-show":t.showSignUp&&!t.showSignIn,"sign-up-turn":!t.showSignUp&&t.showSignIn},on:{click:function(t){t.stopPropagation()}}},[n("div",{staticClass:"slogan"}),t._v(" "),n("div",{staticClass:"form-container"},[n("sign-up-form",{on:{"to-login":t.showLogin}})],1)])])]):t._e()]):t._e()},[],!1,null,null,null).exports),x=(n(30),n(2)),C=n(59),$={name:"WebLayout",components:{VHeader:f,SignDialog:S},mixins:[{beforeMount:function(){var t=Object(x.a)(regeneratorRuntime.mark(function t(){var e,n,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.$store.state.logging){t.next=4;break}e=this.$watch("$store.state.logging",function(){o.$store.state.isAuth?(o.userSigned&&o.userSigned(),e()):o.$cookie.remove("JWT-TOKEN")}),t.next=10;break;case 4:return n=Object(C.a)(),this.$store.commit("SET_USER_TOKEN",n),t.next=8,this.$store.dispatch("initAuth");case 8:t.sent?this.userSigned&&this.userSigned():this.$cookie.remove("JWT-TOKEN");case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}],props:{},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{}},y=Object(h.a)($,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"layout-web"}},[e("v-header"),this._v(" "),e("nuxt"),this._v(" "),e("sign-dialog")],1)},[],!1,null,null,null);e.default=y.exports}}]);