(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{319:function(t,n,e){"use strict";n.a={beforeMount:function(){var t=this;this.$channel.$when("user-not-sign",(function(){t.$toast.error("继续操作前请先登录").then((function(){window.location.href=t.$alias.sign()}))}))}}},420:function(t,n,e){},562:function(t,n,e){"use strict";var o=e(420);e.n(o).a},669:function(t,n,e){"use strict";e.r(n);e(14),e(34),e(5);var o={name:"BangumiJoin",layout:"app",mixins:[e(319).a],data:function(){return{showLaunch:!0,showCreate:!1,rule:null,sheet:null,bangumi:null,questions:[],selected:{},loading:!1}},computed:{slug:function(){return this.$route.query.slug}},watch:{},created:function(){},mounted:function(){this.getBangumiInfo(),this.getBangumiRule()},methods:{getBangumiRule:function(){var t=this;this.$axios.$get("v1/join/rule/show",{params:{slug:this.slug}}).then((function(data){t.rule=data})).catch((function(n){t.$toast.error(n.message)}))},getBangumiInfo:function(){var t=this;this.$axios.$get("v1/bangumi/show",{params:{slug:this.slug}}).then((function(data){t.bangumi=data})).catch((function(n){t.$toast.error(n.message)}))},handleBegin:function(){var t=this;this.$axios.$post("v1/join/begin",{slug:this.slug}).then((function(n){"reject"===n?t.$toast.info("该分区还未开放"):"resolve"===n?t.$toast.info("你已加入该分区"):"no_rule"===n?t.$toast.info("还没有答题规则"):"no_question"===n?(t.$toast.info("分区题目数量不足"),t.showCreate=!0):"pending"===n&&t.getQuestions()})).catch((function(n){t.$toast.error(n.message)}))},getQuestions:function(){var t=this;this.$axios.$get("v1/join/list",{params:{slug:this.slug}}).then((function(data){t.selected=data.extra.answers||{},t.questions=data.result,t.showLaunch=!1})).catch((function(n){t.$toast.error(n.message)}))},handleSelect:function(t,n){var e=this;this.$axios.$post("v1/join/vote",{question_id:t,answer_id:n}).then((function(){e.selected[t]=n})).catch((function(t){e.$toast.error(t.message)}))},restart:function(){var t=this;this.$confirm("你会获取一套新的试题，确定要重做吗？").then((function(){t.loading||(t.loading=!0,t.$axios.$post("v1/join/begin",{slug:t.slug,retry:!0}).then((function(){t.getQuestions()})).catch((function(n){t.$toast.error(n.message)})).finally((function(){t.loading=!1})))})).catch((function(){}))},submit:function(){var t=this;Object.keys(this.selected).length<this.questions.length?this.$toast.info("请先做完所有题目"):this.loading||(this.loading=!0,this.$axios.$post("v1/join/submit",{slug:this.slug}).then((function(n){"pass"===n?t.$toast.success("挑战成功！"):t.$toast.info("挑战失败！")})).catch((function(n){t.$toast.error(n.message)})).finally((function(){t.loading=!1})))}},head:{title:"答题"}},c=(e(562),e(16)),component=Object(c.a)(o,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"bangumi-join"}},[t.showLaunch?e("div",{staticClass:"launch"},[t.bangumi?[e("img",{staticClass:"avatar",attrs:{src:t.$resize(t.bangumi.avatar,{width:150}),alt:""}}),t._v(" "),e("p",[t._v("加入《"+t._s(t.bangumi.name)+"》")])]:t._e(),t._v(" "),t.rule?[e("ul",[e("li",[t._v("该番剧出题："+t._s(t.rule.question_count)+"道")]),t._v(" "),e("li",[t._v("正确率需要："+t._s(t.rule.right_rate)+"%")])])]:t._e(),t._v(" "),e("ElButton",{attrs:{type:"success",round:""},on:{click:t.handleBegin}},[t._v("开始答题")]),t._v(" "),t.showCreate?e("NLink",{attrs:{to:"/app/bangumi/test?slug="+t.slug}},[t._v("出题")]):t._e()],2):[e("ol",{staticClass:"question-list"},t._l(t.questions,(function(n){return e("li",{key:n.id,staticClass:"question-item"},[e("p",{staticClass:"question",domProps:{innerHTML:t._s(n.title)}}),t._v(" "),e("ol",{staticClass:"answers"},t._l(n.answers,(function(o,c){return e("li",{key:c,class:{"is-selected":t.selected[n.id]&&t.selected[n.id]===c},on:{click:function(e){return t.handleSelect(n.id,c)}}},[e("span",{domProps:{innerHTML:t._s(o)}})])})),0),t._v(" "),e("div",{staticClass:"controls"},[e("div",[e("span",[t._v("出题人：")]),t._v(" "),e("span",{domProps:{textContent:t._s(n.user.nickname)}})])])])})),0),t._v(" "),t.questions.length?e("footer",{staticClass:"qa-footer",attrs:{slot:"footer"},slot:"footer"},[e("ElButton",{staticClass:"submit-btn",attrs:{loading:t.loading,type:"success",round:""},on:{click:t.submit}},[t._v("\n        交卷\n      ")])],1):t._e()]],2)}),[],!1,null,null,null);n.default=component.exports}}]);