(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{312:function(t,e,n){"use strict";n(55),n(56),n(9),n(89),n(54),n(38),n(30);var o=n(2),r=n(133);e.a={data:function(){return{uploadHeaders:{key:"",token:""},uploadConfig:{max:5},uploadImageLimit:20,imageUploadAccept:["image/jpeg","image/png","image/jpg"].join(", "),imageUploadAction:"https://upload.qiniup.com",imagePrefix:"https://m1.calibur.tv/",getUpTokenTimer:0,uploadPending:0,uploadImageTotal:0,uploadImageList:[]}},computed:{currentUser:function(){return this.$store.state.user},isAuth:function(){return this.$store.state.isAuth}},watch:{isAuth:function(t){t&&this.initUpToken()}},mounted:function(){this.isAuth&&this.initUpToken()},beforeDestroy:function(){this.getUpTokenTimer&&clearInterval(this.getUpTokenTimer)},methods:{initUpToken:function(){var t=this;this.getUpToken(),this.getUpTokenTimer=setInterval(function(){t.getUpToken()},18e5)},getUpToken:function(){var t=Object(o.a)(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.$cookie.get("UPLOAD-TOKEN"))){t.next=4;break}return this.uploadHeaders.token=this.$cookie.get("UPLOAD-TOKEN"),t.abrupt("return");case 4:return t.next=6,Object(r.b)(this);case 6:e=t.sent,this.uploadHeaders.token=e,this.$cookie.set("UPLOAD-TOKEN",e,{expires:new Date((new Date).getTime()+3e6)});case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),handleImageUploadError:function(t,e){var n=this;this.uploadImageList.forEach(function(o,r){o.uid===e.uid&&(n.uploadPending--,n.uploadImageList.splice(r,1),console.log(t))}),this.$toast.error("图片：".concat(e.name," 上传失败"))},handleImageUploadRemove:function(t){var e=this;this.uploadImageList.forEach(function(n,o){n.uid===t.uid&&(e.uploadImageList.splice(o,1),e.uploadImageTotal--)})},handleImageUploadSuccess:function(t,e){var n=this;this.uploadImageList.forEach(function(o,r){o.uid===e.uid&&(n.uploadImageList[r]=Object.assign(o,{data:t.data,status:"success",url:n.$resize("".concat(n.imagePrefix).concat(t.data.url),{width:100})}))}),this.uploadImageTotal++,this.uploadPending--},handleImageUploadExceed:function(){this.$toast.info("最多还能上传".concat(this.uploadImageLimit-this.uploadImageTotal,"张图片"))},handleImageUploadBefore:function(t){if(!this.isAuth)return this.$channel.$emit("sign-in"),!1;if(-1===this.imageUploadAccept.split(", ").indexOf(t.type))return this.$toast.error("仅支持上传".concat(this.imageUploadAccept.replace(/image\//g,"").replace(/, /g,"、"),"格式的图片")),!1;if(this.uploadConfig.max&&this.uploadConfig.max<t.size/1024/1024)return this.$toast.error("图片大小不能超过 ".concat(this.uploadConfig.max,"MB!")),!1;return this.uploadHeaders.key=function(t){var e=t.slug,n=t.file;return"".concat(e,"/").concat((new Date).getTime(),"-").concat(Math.random().toString(36).substring(3,6),".").concat(n.type.split("/").pop())}({slug:this.currentUser.slug,file:t}),this.uploadImageList.push({name:t.name,percentage:0,raw:t,size:t.size,status:"uploading",errMsg:"",uid:t.uid}),this.uploadPending++,!0}}}},329:function(t,e,n){},387:function(t,e,n){"use strict";var o=n(329);n.n(o).a},466:function(t,e,n){"use strict";n.r(e);var o=n(50),r=(n(58),n(9),n(137),n(312)),c=n(133),l={name:"JsonEditor",mixins:[r.a],props:{source:{type:Object,default:null},autofocus:{type:Boolean,default:!1}},data:function(){return{editor:null}},mounted:function(){this.initEditor()},methods:{initEditor:function(){var t=this;Promise.all([n.e(46).then(n.t.bind(null,453,7)),n.e(48).then(n.t.bind(null,454,7)),n.e(51).then(n.t.bind(null,455,7)),n.e(45).then(n.t.bind(null,456,7)),n.e(50).then(n.t.bind(null,457,7)),n.e(49).then(n.t.bind(null,458,7)),n.e(44).then(n.t.bind(null,459,7)),n.e(47).then(n.t.bind(null,460,7))]).then(function(e){var n=t,data={};n.source?data=n.source:n.$cache.has("editor_local_draft")&&(data=n.$cache.get("editor_local_draft"));var r=e.map(function(t){return t.default}),l=Object(o.a)(r,8),d=l[0],h=l[1],f=l[2],m=l[3],v=l[4],T=l[5],k=l[6],U=l[7],w=new d({data:data,holder:"codex-editor",placeholder:"请输入内容",autofocus:n.autofocus,tools:{embed:{class:U,inlineToolbar:!0,config:{services:{bilibili:{regex:/https?:\/\/www\.bilibili\.com\/video\/av([^\\?\\&]*)/,embedUrl:"//player.bilibili.com/player.html?aid=<%= remote_id %>",html:"<iframe scrolling='no' border='0' frameborder='no' framespacing='0' allowtransparency='true' allowfullscreen='true'></iframe>"}}}},header:{class:h,shortcut:"CMD+SHIFT+H",inlineToolbar:!0},image:{class:T,shortcut:"CMD+SHIFT+P",types:"image/jpeg, image/png, image/jpg",config:{uploader:{uploadByFile:function(t){return new Promise(function(e,o){var r=new FormData;r.append("file",t),r.append("token",n.uploadHeaders.token),Object(c.c)(n,r).then(function(data){data.url="https://m1.calibur.tv/".concat(data.url),e({success:1,file:data})}).catch(o)})}}}},link:{class:v,shortcut:"CMD+SHIFT+L",config:{endpoint:"".concat("https://api.calibur.tv/","v1/pin/editor/fetch_site")}},delimiter:m,list:{class:f,shortcut:"CMD+SHIFT+U",inlineToolbar:!0},checklist:{class:k,inlineToolbar:!0}},onChange:function(){n.handleSave()}});w.isReady.then(function(){t.editor=w,t.bindSaveEvent()}).catch(function(e){t.$toast.error("编辑器初始化失败：".concat(e))})})},bindSaveEvent:function(){var t=this;document.addEventListener("keydown",function(e){83===e.keyCode&&(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),e.preventDefault(),t.handleSave())},!1)},handleSave:function(){var t=this;this.editor&&this.editor.save().then(function(e){t.$cache.set("editor_local_draft",e)}).catch(function(){t.$toast.error("保存失败")})}}},d=(n(387),n(18)),h={name:"CreateATField",components:{Editor:Object(d.a)(l,function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"editor-wrap"},[e("div",{staticClass:"mousetrap",attrs:{id:"codex-editor"}})])}],!1,null,null,null).exports},props:{tags:{type:Array,required:!0}},computed:{},watch:{},created:function(){}},f=Object(d.a)(h,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"create-atfield"}},[e("editor")],1)},[],!1,null,null,null);e.default=f.exports}}]);