(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{265:function(e,t,n){"use strict";n(64),n(62),n(37);var o=n(2),l=n(108);t.a={data:()=>({uploadHeaders:{key:"",token:""},uploadConfig:{max:5},uploadImageLimit:20,imageUploadAccept:["image/jpeg","image/png","image/jpg"].join(", "),imageUploadAction:"https://upload.qiniup.com",imagePrefix:"https://m1.calibur.tv/",getUpTokenTimer:0,uploadPending:0,uploadImageTotal:0,uploadImageList:[]}),computed:{currentUser(){return this.$store.state.user},isAuth(){return this.$store.state.isAuth}},watch:{isAuth(e){e&&this.initUpToken()}},mounted(){this.isAuth&&this.initUpToken()},beforeDestroy(){this.getUpTokenTimer&&clearInterval(this.getUpTokenTimer)},methods:{initUpToken(){this.getUpToken(),this.getUpTokenTimer=setInterval(()=>{this.getUpToken()},18e5)},getUpToken(){var e=this;return Object(o.a)(function*(){let t=e.$cookie.get("UPLOAD-TOKEN");t?e.uploadHeaders.token=e.$cookie.get("UPLOAD-TOKEN"):(t=yield Object(l.b)(e),e.uploadHeaders.token=t,e.$cookie.set("UPLOAD-TOKEN",t,{expires:new Date((new Date).getTime()+3e6)}))})()},handleImageUploadError(e,t){this.uploadImageList.forEach((n,o)=>{n.uid===t.uid&&(this.uploadPending--,this.uploadImageList.splice(o,1),console.log(e))}),this.$toast.error("图片：".concat(t.name," 上传失败"))},handleImageUploadRemove(e){this.uploadImageList.forEach((t,n)=>{t.uid===e.uid&&(this.uploadImageList.splice(n,1),this.uploadImageTotal--)})},handleImageUploadSuccess(e,t){this.uploadImageList.forEach((n,o)=>{n.uid===t.uid&&(this.uploadImageList[o]=Object.assign(n,{data:e.data,status:"success",url:this.$resize("".concat(this.imagePrefix).concat(e.data.url),{width:100})}))}),this.uploadImageTotal++,this.uploadPending--},handleImageUploadExceed(){this.$toast.info("最多还能上传".concat(this.uploadImageLimit-this.uploadImageTotal,"张图片"))},handleImageUploadBefore(e){if(!this.isAuth)return this.$channel.$emit("sign-in"),!1;if(-1===this.imageUploadAccept.split(", ").indexOf(e.type))return this.$toast.error("仅支持上传".concat(this.imageUploadAccept.replace(/image\//g,"").replace(/, /g,"、"),"格式的图片")),!1;if(this.uploadConfig.max&&this.uploadConfig.max<e.size/1024/1024)return this.$toast.error("图片大小不能超过 ".concat(this.uploadConfig.max,"MB!")),!1;return this.uploadHeaders.key=(e=>{let{slug:t,file:n}=e;return"".concat(t,"/").concat((new Date).getTime(),"-").concat(Math.random().toString(36).substring(3,6),".").concat(n.type.split("/").pop())})({slug:this.currentUser.slug,file:e}),this.uploadImageList.push({name:e.name,percentage:0,raw:e,size:e.size,status:"uploading",errMsg:"",uid:e.uid}),this.uploadPending++,!0}}}},276:function(e,t,n){e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var l=t[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,n),l.l=!0,l.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(o,l,function(t){return e[t]}.bind(null,l));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(object,e){return Object.prototype.hasOwnProperty.call(object,e)},n.p="/dist/",n(n.s=52)}({0:function(e,t,n){"use strict";function o(e,t,n,o,l,r,c,d){var h,m="function"==typeof e?e.options:e;if(t&&(m.render=t,m.staticRenderFns=n,m._compiled=!0),o&&(m.functional=!0),r&&(m._scopeId="data-v-"+r),c?(h=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),l&&l.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(c)},m._ssrRegister=h):l&&(h=d?function(){l.call(this,this.$root.$options.shadowRoot)}:l),h)if(m.functional){m._injectStyles=h;var f=m.render;m.render=function(e,t){return h.call(t),f(e,t)}}else{var v=m.beforeCreate;m.beforeCreate=v?[].concat(v,h):[h]}return{exports:e,options:m}}n.d(t,"a",function(){return o})},3:function(e,t){e.exports=n(36)},33:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"el-select-dropdown__item",class:{selected:e.itemSelected,"is-disabled":e.disabled||e.groupDisabled||e.limitReached,hover:e.hover},on:{mouseenter:e.hoverItem,click:function(t){return t.stopPropagation(),e.selectOptionClick(t)}}},[e._t("default",[n("span",[e._v(e._s(e.currentLabel))])])],2)};o._withStripped=!0;var l=n(4),r=n.n(l),c=n(3),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h={mixins:[r.a],name:"ElOption",componentName:"ElOption",inject:["select"],props:{value:{required:!0},label:[String,Number],created:Boolean,disabled:{type:Boolean,default:!1}},data:function(){return{index:-1,groupDisabled:!1,visible:!0,hitState:!1,hover:!1}},computed:{isObject:function(){return"[object object]"===Object.prototype.toString.call(this.value).toLowerCase()},currentLabel:function(){return this.label||(this.isObject?"":this.value)},currentValue:function(){return this.value||this.label||""},itemSelected:function(){return this.select.multiple?this.contains(this.select.value,this.value):this.isEqual(this.value,this.select.value)},limitReached:function(){return!!this.select.multiple&&(!this.itemSelected&&(this.select.value||[]).length>=this.select.multipleLimit&&this.select.multipleLimit>0)}},watch:{currentLabel:function(){this.created||this.select.remote||this.dispatch("ElSelect","setSelected")},value:function(e,t){var n=this.select,o=n.remote,l=n.valueKey;if(!this.created&&!o){if(l&&"object"===(void 0===e?"undefined":d(e))&&"object"===(void 0===t?"undefined":d(t))&&e[l]===t[l])return;this.dispatch("ElSelect","setSelected")}}},methods:{isEqual:function(a,b){if(this.isObject){var e=this.select.valueKey;return Object(c.getValueByPath)(a,e)===Object(c.getValueByPath)(b,e)}return a===b},contains:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];if(this.isObject){var n=this.select.valueKey;return e&&e.some(function(e){return Object(c.getValueByPath)(e,n)===Object(c.getValueByPath)(t,n)})}return e&&e.indexOf(t)>-1},handleGroupDisabled:function(e){this.groupDisabled=e},hoverItem:function(){this.disabled||this.groupDisabled||(this.select.hoverIndex=this.select.options.indexOf(this))},selectOptionClick:function(){!0!==this.disabled&&!0!==this.groupDisabled&&this.dispatch("ElSelect","handleOptionClick",[this,!0])},queryChange:function(e){this.visible=new RegExp(Object(c.escapeRegexpString)(e),"i").test(this.currentLabel)||this.created,this.visible||this.select.filteredOptionsCount--}},created:function(){this.select.options.push(this),this.select.cachedOptions.push(this),this.select.optionsCount++,this.select.filteredOptionsCount++,this.$on("queryChange",this.queryChange),this.$on("handleGroupDisabled",this.handleGroupDisabled)},beforeDestroy:function(){this.select.onOptionDestroy(this.select.options.indexOf(this))}},m=n(0),component=Object(m.a)(h,o,[],!1,null,null,null);component.options.__file="packages/select/src/option.vue";t.a=component.exports},4:function(e,t){e.exports=n(35)},52:function(e,t,n){"use strict";n.r(t);var o=n(33);o.a.install=function(e){e.component(o.a.name,o.a)},t.default=o.a}})},284:function(e,t,n){},330:function(e,t,n){"use strict";var o=n(284);n.n(o).a},380:function(e,t,n){"use strict";n.r(t);var o=n(276),l=n.n(o),r=n(277),c=n.n(r),d=n(274),h=n.n(d),m=n(265),f={name:"CreateTalkForm",components:{"el-upload":h.a,"el-select":c.a,"el-option":l.a},mixins:[m.a],props:{parentSlug:{type:String,default:""},parentType:{type:String,default:"",validator:e=>~["","pin","tag"].indexOf(e)}},data:()=>({uploadImageLimit:9,title:"",content:""}),computed:{},watch:{},created(){},mounted(){},methods:{customImageUploadSuccess(e,t){this.handleImageUploadSuccess(e,t),this.uploadImageList=this.uploadImageList.filter(e=>"success"===e.status&&e.data.width>=420&&e.data.height>=420||"success"!==e.status),this.uploadImageTotal=this.uploadImageList.length},submit(){this.$axios.$post("v1/pin/create/daily",{title:this.title,content:this.content,images:this.uploadImageList.map(e=>e.data)}).then(data=>{console.log(data)}).catch(e=>{this.$toast.error(e.message)})}}},v=(n(330),n(18)),y={name:"CreateDaily",components:{CreateTalkForm:Object(v.a)(f,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"create-talk-form"},[n("div",{staticClass:"title-wrap"},[n("el-input",{attrs:{placeholder:"请输入标题（建议30字以内）",maxlength:"30"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),e._v(" "),n("div",{staticClass:"content-wrap"},[n("button",{staticClass:"submit-btn",on:{click:e.submit}},[e._v("\n      点击"),n("br"),e._v("发送\n    ")]),e._v(" "),n("div",{staticClass:"input-wrap"},[n("el-input",{attrs:{type:"textarea",autosize:{minRows:3},"show-word-limit":!0,maxlength:"10000",placeholder:"请输入正文（请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论）"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)]),e._v(" "),n("el-upload",{staticClass:"el-upload-wrap",attrs:{multiple:"","list-type":"picture-card",action:e.imageUploadAction,limit:e.uploadImageLimit,data:e.uploadHeaders,"file-list":e.uploadImageList,accept:e.imageUploadAccept,"before-upload":e.handleImageUploadBefore,"on-success":e.customImageUploadSuccess,"on-error":e.handleImageUploadError,"on-remove":e.handleImageUploadRemove,"on-exceed":e.handleImageUploadExceed}},[n("i",{staticClass:"el-icon-plus"})])],1)},[],!1,null,null,null).exports},props:{},data:()=>({}),computed:{},watch:{},created(){},mounted(){},methods:{}},O=Object(v.a)(y,function(){var e=this.$createElement;return(this._self._c||e)("create-talk-form")},[],!1,null,null,null);t.default=O.exports}}]);