exports.ids=[9],exports.modules={115:function(e,t,o){"use strict";o.r(t);var l=o(80),n=o.n(l);for(var r in l)"default"!==r&&function(e){o.d(t,e,function(){return l[e]})}(r);t.default=n.a},152:function(e,t,o){"use strict";o.r(t);var l=o(48),n=o.n(l),r=o(47),d=o.n(r),c=o(46),m=o.n(c),h=o(73),f={name:"CreateTalkForm",components:{"el-upload":m.a,"el-select":d.a,"el-option":n.a},mixins:[h.a],props:{parentSlug:{type:String,default:""},parentType:{type:String,default:"",validator:e=>~["","pin","tag"].indexOf(e)}},data:()=>({uploadImageLimit:9,title:"",content:""}),computed:{},watch:{},created(){},mounted(){},methods:{customImageUploadSuccess(e,t){this.handleImageUploadSuccess(e,t),this.uploadImageList=this.uploadImageList.filter(e=>"success"===e.status&&e.data.width>=420&&e.data.height>=420||"success"!==e.status),this.uploadImageTotal=this.uploadImageList.length},submit(){this.$axios.$post("v1/pin/create/daily",{title:this.title,content:this.content,images:this.uploadImageList.map(e=>e.data)}).then(data=>{console.log(data)}).catch(e=>{this.$toast.error(e.message)})}}},I=o(2);var U={name:"CreateDaily",components:{CreateTalkForm:Object(I.a)(f,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"create-talk-form"},[e._ssrNode('<div class="title-wrap">',"</div>",[o("el-input",{attrs:{placeholder:"请输入标题（建议30字以内）",maxlength:"30"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),e._ssrNode(" "),e._ssrNode('<div class="content-wrap">',"</div>",[e._ssrNode('<button class="submit-btn">\n      点击<br>发送\n    </button> '),e._ssrNode('<div class="input-wrap">',"</div>",[o("el-input",{attrs:{type:"textarea",autosize:{minRows:3},"show-word-limit":!0,maxlength:"10000",placeholder:"请输入正文（请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论）"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)],2),e._ssrNode(" "),o("el-upload",{staticClass:"el-upload-wrap",attrs:{multiple:"","list-type":"picture-card",action:e.imageUploadAction,limit:e.uploadImageLimit,data:e.uploadHeaders,"file-list":e.uploadImageList,accept:e.imageUploadAccept,"before-upload":e.handleImageUploadBefore,"on-success":e.customImageUploadSuccess,"on-error":e.handleImageUploadError,"on-remove":e.handleImageUploadRemove,"on-exceed":e.handleImageUploadExceed}},[o("i",{staticClass:"el-icon-plus"})])],2)},[],!1,function(e){var t=o(115);t.__inject__&&t.__inject__(e)},null,"4456a552").exports},props:{},data:()=>({}),computed:{},watch:{},created(){},mounted(){},methods:{}};var $=Object(I.a)(U,function(){var e=this.$createElement;return(this._self._c||e)("create-talk-form")},[],!1,function(e){},null,"0e6fb44d");t.default=$.exports},73:function(e,t,o){"use strict";t.a={data:()=>({uploadHeaders:{key:"",token:""},uploadConfig:{max:5},uploadImageLimit:20,imageUploadAccept:["image/jpeg","image/png","image/jpg"].join(", "),imageUploadAction:"https://upload.qiniup.com",imagePrefix:"https://m1.calibur.tv/",getUpTokenTimer:0,uploadPending:0,uploadImageTotal:0,uploadImageList:[]}),computed:{currentUser(){return this.$store.state.user},isAuth(){return this.$store.state.isAuth}},watch:{isAuth(e){e&&this.initUpToken()}},mounted(){this.isAuth&&this.initUpToken()},beforeDestroy(){this.getUpTokenTimer&&clearInterval(this.getUpTokenTimer)},methods:{initUpToken(){this.getUpToken(),this.getUpTokenTimer=setInterval(()=>{this.getUpToken()},18e5)},async getUpToken(){let e=this.$cookie.get("UPLOAD-TOKEN");e?this.uploadHeaders.token=this.$cookie.get("UPLOAD-TOKEN"):(e=await(e=>e.$axios.$get("v1/image/uptoken"))(this),this.uploadHeaders.token=e,this.$cookie.set("UPLOAD-TOKEN",e,{expires:new Date((new Date).getTime()+3e6)}))},handleImageUploadError(e,t){this.uploadImageList.forEach((o,l)=>{o.uid===t.uid&&(this.uploadPending--,this.uploadImageList.splice(l,1),console.log(e))}),this.$toast.error(`图片：${t.name} 上传失败`)},handleImageUploadRemove(e){this.uploadImageList.forEach((t,o)=>{t.uid===e.uid&&(this.uploadImageList.splice(o,1),this.uploadImageTotal--)})},handleImageUploadSuccess(e,t){this.uploadImageList.forEach((o,l)=>{o.uid===t.uid&&(this.uploadImageList[l]=Object.assign(o,{data:e.data,status:"success",url:this.$resize(`${this.imagePrefix}${e.data.url}`,{width:100})}))}),this.uploadImageTotal++,this.uploadPending--},handleImageUploadExceed(){this.$toast.info(`最多还能上传${this.uploadImageLimit-this.uploadImageTotal}张图片`)},handleImageUploadBefore(e){if(!this.isAuth)return this.$channel.$emit("sign-in"),!1;if(-1===this.imageUploadAccept.split(", ").indexOf(e.type))return this.$toast.error(`仅支持上传${this.imageUploadAccept.replace(/image\//g,"").replace(/, /g,"、")}格式的图片`),!1;if(this.uploadConfig.max&&this.uploadConfig.max<e.size/1024/1024)return this.$toast.error(`图片大小不能超过 ${this.uploadConfig.max}MB!`),!1;return this.uploadHeaders.key=(({slug:e,file:t})=>`${e}/${(new Date).getTime()}-${Math.random().toString(36).substring(3,6)}.${t.type.split("/").pop()}`)({slug:this.currentUser.slug,file:e}),this.uploadImageList.push({name:e.name,percentage:0,raw:e,size:e.size,status:"uploading",errMsg:"",uid:e.uid}),this.uploadPending++,!0}}}},80:function(e,t){}};
//# sourceMappingURL=dc8f7709c27b80b7aaad.js.map