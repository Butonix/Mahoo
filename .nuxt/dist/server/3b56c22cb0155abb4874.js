exports.ids=[18],exports.modules={100:function(t,e,n){"use strict";n.r(e);var r=n(71),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},101:function(t,e,n){"use strict";n.r(e);var r=n(72),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},102:function(t,e,n){"use strict";n.r(e);var r=n(73),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},103:function(t,e,n){"use strict";n.r(e);var r=n(74),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},104:function(t,e,n){"use strict";n.r(e);var r=n(75),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},114:function(t,e,n){"use strict";n.r(e);var r=n(49),o=n.n(r),c=(n(96),n(56)),l={name:"ChatAvatar",components:{UserAvatar:c.a},props:{item:{type:Object,required:!0}},computed:{isMine(){return this.$store.state.user.slug===this.item.slug}}},f=n(1);var _=Object(f.a)(l,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"chat-avatar",class:[this.isMine?"chat-avatar-mine":"chat-avatar-other"]},[e("user-avatar",{attrs:{user:this.item,size:36}})],1)},[],!1,function(t){var e=n(97);e.__inject__&&e.__inject__(t)},null,"630a9f70").exports,m=n(86),d={name:"JsonContentTxtParser",props:{item:{type:Object,required:!0}}};var h=Object(f.a)(d,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"json-content-txt-parser"},[this._ssrNode("<p>"+this._s(this.item.content)+"</p>")])},[],!1,function(t){var e=n(98);e.__inject__&&e.__inject__(t)},null,"a8aa203e").exports,v={name:"JsonContentImgParser",props:{item:{type:Object,required:!0}}};var x=Object(f.a)(v,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"json-content-img-parser"},[t._ssrNode("<img"+t._ssrAttr("src",t.$resize(t.item.url))+t._ssrAttr("width",t.item.width)+t._ssrAttr("height",t.item.height)+t._ssrAttr("alt",t.item.text)+"> "+(t.item.text?'<p class="img-tip">'+t._ssrEscape(t._s(t.item.text))+"</p>":"\x3c!----\x3e"))])},[],!1,function(t){var e=n(99);e.__inject__&&e.__inject__(t)},null,"f06b0d18").exports,j={name:"JsonContentTxtParser",props:{item:{type:Object,required:!0}}};var C=Object(f.a)(j,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"json-content-txt-parser"},[this._ssrNode("<blockquote>"+this._s(this.item.text)+"</blockquote>")])},[],!1,function(t){var e=n(100);e.__inject__&&e.__inject__(t)},null,"8b617b90").exports,y={name:"JsonContentTxtParser",props:{item:{type:Object,required:!0}}};var k=Object(f.a)(y,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"json-content-txt-parser"},[this._ssrNode(this.item.text?"<h3>"+this._ssrEscape(this._s(this.item.text))+"</h3>":"\x3c!----\x3e")])},[],!1,function(t){var e=n(101);e.__inject__&&e.__inject__(t)},null,"55f76f49").exports,$={name:"JsonContentListParser",props:{item:{type:Object,required:!0}},computed:{list(){let t=this.item.text;if(!t)return[];for(;/\n\n/.test(t);)t=t.replace(/\n\n/g,"\n");return t.split("\n")}}};var O={name:"JsonContent",components:{TitleParser:k,TxtParser:h,ImgParser:x,UseParser:C,ListParser:Object(f.a)($,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"json-content-list-parser"},[t._ssrNode("1"===t.item.sort?"<ol>"+t._ssrList(t.list,function(li,e){return"<li>"+t._ssrEscape(t._s(li))+"</li>"})+"</ol>":"<ul>"+t._ssrList(t.list,function(li,e){return"<li>"+t._ssrEscape(t._s(li))+"</li>"})+"</ul>")])},[],!1,function(t){var e=n(102);e.__inject__&&e.__inject__(t)},null,"0247939b").exports},props:{content:{required:!0,type:Array},show:{type:Boolean,default:!0}}},w={name:"ChatMessage",components:{JsonContent:Object(f.a)(O,function(){var t=this.$createElement,e=this._self._c||t;return this.show?e("div",{staticClass:"json-content"},this._l(this.content,function(t,n){return e(t.type+"-parser",{key:n,tag:"component",attrs:{item:t}})}),1):this._e()},[],!1,null,null,"db874c02").exports},props:{item:{type:Object,required:!0}}};var E=Object(f.a)(w,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"chat-message"},[e("json-content",{attrs:{content:this.item.content}})],1)},[],!1,function(t){var e=n(103);e.__inject__&&e.__inject__(t)},null,"959e5200").exports,M=n(20),P=n(7),A={name:"UserMessage",components:{ChatRoom:o.a,UserAvatar:c.a,UserNickname:m.a},data:()=>({message:"",target:null,menu:[]}),computed:{avatarComp:()=>_,messageComps:()=>({message:E}),mailto(){return this.$route.query.mailto},status(){return this.$store.state.socket.reconnectError?"error":this.$store.state.socket.isConnected?"ok":"warn"}},watch:{"$store.state.socket.lastGetAt"(){this.appendMessage(this.$store.state.socket.message)}},created(){},mounted(){this.getMailtoUser(),this.getMessageMenu()},methods:{getMailtoUser(){this.mailto&&Object(P.c)(this,{slug:this.mailto}).then(t=>{this.target=t}).catch(t=>{this.$toast.error(t.message)})},getMessageMenu(){this.$axios.$get("v1/message/menu").then(data=>{this.menu=data})},appendMessage(t){this.$refs.room.addMessage({type:"message",float:"left",id:Math.random().toString(10).substring(3,6),color:2===t.from_user.sex?{bg:"#ff6881",text:"#fff"}:{bg:"#12b7f5",text:"#fff"},data:{content:t.content,created_at:t.created_at,user:t.from_user}})},handleAddBubble(){if("warn"===this.status)return void this.$toast.info("正在连接服务器");if("error"===this.status)return void this.$toast.error("请稍候再试");if(!this.message.trim())return;const t=this.$store.state.user,e=[{type:"txt",content:this.message.trim().replace(/\r?\n/g,"<br>")}];this.$refs.room.addMessage({type:"message",float:"right",id:Math.random().toString(10).substring(3,6),color:2===t.sex?{bg:"#ff6881",text:"#fff"}:{bg:"#12b7f5",text:"#fff"},data:{content:e,created_at:Date.now(),user:t}}),this.message="",this.$channel.send({message_type:1,to_user_slug:this.mailto,from_user_token:Object(M.a)(),content:e})},handleNewLine(){this.message&&(this.message+="\n")}}};var N=Object(f.a)(A,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container",attrs:{id:"user-message"}},[n("el-row",[n("el-col",{attrs:{span:6}},[n("ul",{staticClass:"message-menu"},t._l(t.menu,function(e){return n("li",{key:e.channel},[n("nuxt-link",{staticClass:"clearfix",attrs:{to:t.$alias.user(t.$route.params.slug,"message/?mailto="+e.user.slug),tag:"div"}},[n("user-avatar",{attrs:{user:e.user}}),t._v(" "),n("div",{staticClass:"content"},[n("user-nickname",{attrs:{user:e.user}})],1)],1)],1)}),0)]),t._v(" "),n("el-col",{attrs:{span:12}},[n("div",{staticClass:"message-header"},[n("div",{staticClass:"status",class:"status-"+t.status})]),t._v(" "),n("ChatRoom",{ref:"room",attrs:{"avatar-component":t.avatarComp,"message-components":t.messageComps}}),t._v(" "),n("div",[n("el-input",{attrs:{type:"textarea",rows:5,resize:"none",maxlength:"500",placeholder:"say it..."},nativeOn:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:(e.preventDefault(),t.handleAddBubble(e))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.metaKey?(e.preventDefault(),t.handleNewLine(e)):null}]},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1)],1),t._v(" "),n("el-col",{attrs:{span:6}},[t._v("\n \n      ")])],1)],1)},[],!1,function(t){var e=n(104);e.__inject__&&e.__inject__(t)},null,"1992ef02");e.default=N.exports},52:function(t,e){},53:function(t,e){},56:function(t,e,n){"use strict";var r={name:"UserAvatar",props:{user:{type:Object,required:!0},avatar:{type:String,default:""},size:{type:Number,default:40}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("nuxt-link",{staticClass:"user-avatar",style:{width:t.size+"px",height:t.size+"px"},attrs:{to:t.$alias.user(t.user.slug)}},[n("img",{staticClass:"avatar",attrs:{src:t.$resize(t.avatar||t.user.avatar,{width:t.size}),alt:t.user.nickname}})])},[],!1,function(t){var e=n(63);e.__inject__&&e.__inject__(t)},null,"8c0ebd70");e.a=component.exports},63:function(t,e,n){"use strict";n.r(e);var r=n(52),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},64:function(t,e,n){"use strict";n.r(e);var r=n(53),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},68:function(t,e){},69:function(t,e){},70:function(t,e){},71:function(t,e){},72:function(t,e){},73:function(t,e){},74:function(t,e){},75:function(t,e){},86:function(t,e,n){"use strict";var r={name:"UserNickname",props:{user:{type:Object,required:!0},sex:{type:Number,default:0},level:{type:Boolean,default:!0},badge:{type:Boolean,default:!0},nickname:{type:String,default:""}},computed:{sexClass(){switch(this.sex){case-1:return{name:"simi",color:"limegreen"};case 0:return{name:"unknown",color:"gold"};case 1:return{name:"nan",color:"deepskyblue"};case 2:return{name:"nv",color:"hotpink"};default:return{name:"weizhi",color:"gold"}}}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"clearfix"},[n("nuxt-link",{staticClass:"user-nickname",attrs:{to:t.$alias.user(t.user.slug)}},[n("div",{staticClass:"nickname"},[n("p",{staticClass:"oneline",domProps:{textContent:t._s(t.nickname||t.user.nickname)}})]),t._v(" "),t.sex?n("span",{staticClass:"badge"},[n("i",{staticClass:"iconfont ic-sex",class:"ic-"+t.sexClass.name,style:{backgroundColor:t.sexClass.color}})]):t._e(),t._v(" "),t.level?n("span",{staticClass:"badge ic-level",domProps:{textContent:t._s("Lv"+t.user.level)}}):t._e(),t._v(" "),t.badge?t._l(t.user.roles,function(e,r){return n("span",{key:r,staticClass:"badge ic-badge",domProps:{textContent:t._s(e)}})}):t._e()],2)],1)},[],!1,function(t){var e=n(64);e.__inject__&&e.__inject__(t)},null,"5b0047c6");e.a=component.exports},96:function(t,e){},97:function(t,e,n){"use strict";n.r(e);var r=n(68),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},98:function(t,e,n){"use strict";n.r(e);var r=n(69),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},99:function(t,e,n){"use strict";n.r(e);var r=n(70),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a}};
//# sourceMappingURL=3b56c22cb0155abb4874.js.map